rule MAL_ELF_SysJoker_Jan_2022_1
{
    meta:
        description = "Detect ELF version of SysJoker backdoor"
        author = "Arkbird_SOLG"
        date = "2022-01-11"
        reference = "https://www.intezer.com/blog/malware-analysis/new-backdoor-sysjoker/"
        hash1 = "bd0141e88a0d56b508bc52db4dab68a49b6027a486e4d9514ec0db006fe71eed"
        hash2 = "d028e64bf4ec97dfd655ccd1157a5b96515d461a710231ac8a529d7bdb936ff3"
        tlp = "Clear"
        adversary = "-"
    strings:
        $s1 = { 48 8d 85 50 ff ff ff be [2] 45 00 48 89 c7 e8 [2] 00 00 48 89 c2 48 8d 45 c0 48 89 d6 48 89 c7 e8 [2] 00 00 48 8d 85 18 ff ff ff 48 8d 55 c0 48 89 d6 48 89 c7 e8 ?? d7 ff ff 48 8d 45 c0 48 89 c7 e8 [2] 00 00 48 8d 85 18 ff ff ff be [2] 45 00 48 89 c7 e8 [2] 00 00 84 c0 0f 84 f1 00 00 00 48 8d 95 18 ff ff ff 48 8d 45 c8 48 89 d6 48 89 c7 e8 [2] 00 00 48 8d 85 10 ff ff ff 48 8d 4d c8 ba 00 00 00 00 48 89 ce 48 89 c7 e8 [2] ff ff 48 8d 45 c8 48 89 c7 e8 [2] 00 00 48 8d 45 d0 48 8d 95 10 ff ff ff be [2] 45 00 48 89 c7 e8 [2] 00 00 48 8d 85 08 ff ff ff 48 8d 4d d0 ba [2] 45 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 45 d0 48 89 c7 e8 [2] 00 00 48 8d 95 08 ff ff ff 48 8d 45 d8 48 89 d6 48 89 c7 e8 [2] 00 00 48 8b 95 f8 fe ff ff 48 8d 45 e0 48 89 d6 48 89 c7 e8 [2] 00 00 48 8d 55 d8 48 8d 45 e0 48 89 d6 48 89 c7 e8 4d f9 ff ff 48 8d 45 e0 48 89 c7 e8 [2] 00 00 48 8d 45 d8 48 89 c7 e8 [2] 00 00 48 8d 85 08 ff ff ff 48 89 c7 e8 [2] 00 00 48 8d 85 10 ff ff ff 48 }
        $s2 = { 48 8d 85 48 ff ff ff 48 8d 95 b0 fe ff ff be [2] 45 00 48 89 c7 e8 [2] 00 00 48 8d 85 40 ff ff ff 48 8d 8d 48 ff ff ff ba [2] 45 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 85 38 ff ff ff 48 8b 95 80 fc ff ff 48 8d 8d 40 ff ff ff 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 85 30 ff ff ff 48 8d 8d 38 ff ff ff ba [2] 45 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 85 28 ff ff ff 48 8d 8d 30 ff ff ff ba 00 00 00 00 48 89 ce 48 89 c7 e8 [2] ff ff 48 8d 85 28 ff ff ff 48 89 c7 e8 [2] 00 00 48 8d 85 30 ff ff ff 48 89 c7 e8 [2] 00 00 48 8d 85 38 ff ff ff 48 89 c7 e8 [2] 00 00 48 8d 85 40 ff ff ff 48 89 c7 e8 [2] 00 00 48 8d 85 48 ff ff ff 48 89 c7 e8 [2] 00 00 48 8d 8d b0 fe ff ff 48 8d 85 50 ff ff ff ba 02 00 00 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 85 50 ff ff ff 48 89 c7 e8 [2] 00 00 89 c3 48 8d 85 50 ff ff ff 48 89 c7 e8 [2] 00 00 84 db 74 33 48 8d 8d b0 fe ff ff 48 8d 45 80 ba 02 00 00 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 45 80 48 89 c7 e8 [2] 02 00 48 8d 45 80 48 89 c7 e8 [2] 00 00 48 8d 45 b0 48 8b 8d 80 fc ff ff ba [2] 45 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 85 a0 fc ff ff 48 8b 95 78 fc ff ff 48 8d 4d b0 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 45 b0 48 89 c7 e8 [2] 00 00 48 8d 45 c8 48 8d 95 a0 fc ff ff be [2] 45 00 48 89 c7 e8 [2] 00 00 48 8d 45 c0 48 8d 4d c8 ba [2] 45 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 45 b8 48 8d 4d c0 ba 00 00 00 00 48 89 ce 48 89 c7 e8 [2] ff ff 48 8d 45 b8 48 89 c7 e8 [2] 00 00 48 8d 45 c0 48 89 c7 e8 [2] 00 00 48 8d 45 c8 48 89 c7 e8 [2] 00 00 48 8d 45 d0 48 8d 95 a0 fc ff ff be [2] 45 00 48 89 c7 e8 [2] 00 00 48 8d 85 98 fc ff ff 48 8d 4d d0 ba [2] 45 00 48 89 ce 48 89 c7 e8 [2] 00 00 48 8d 45 d0 48 89 c7 e8 [2] 00 00 48 8d 85 98 fc ff ff 48 89 c7 e8 [2] 00 00 48 89 c7 e8 ?? c6 ff ff 48 8b 45 e0 48 89 c7 e8 [2] ff ff bb 01 00 00 00 48 8d 85 98 fc ff ff 48 89 c7 e8 [2] 00 00 48 8d 85 }
        $s3 = { ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff b8 [2] 68 00 ba [2] 46 00 be [2] 68 00 48 89 c7 e8 cc 21 00 00 ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff b8 [2] 68 00 ba [2] 46 00 be [2] 68 00 48 89 c7 e8 a1 21 00 00 ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff 48 8d 45 d0 ba [2] 45 00 be [2] 68 00 48 89 c7 e8 77 21 00 00 b9 [2] 68 00 48 8d 45 d0 ba [2] 68 00 48 89 c6 48 89 cf e8 3f 24 00 00 48 8d 45 d0 48 89 c7 e8 bd 20 00 00 ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff 48 8d 45 dd 48 89 c7 e8 [2] ff ff 48 8d 45 dd 48 89 c2 be [2] 46 00 bf [2] 68 00 e8 8d 23 00 00 48 8d 45 dd 48 89 c7 e8 [2] ff ff ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff 48 8d 45 de 48 89 c7 e8 [2] ff ff 48 8d 45 de 48 89 c2 be [2] 45 00 bf [2] 68 00 e8 4b 23 00 00 48 8d 45 de 48 89 c7 e8 [2] ff ff ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff 48 8d 45 df 48 89 c7 e8 [2] ff ff 48 8d 45 df 48 89 c2 be [2] 45 00 bf [2] 68 00 e8 09 23 00 00 48 8d 45 df 48 89 c7 e8 [2] ff ff ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff e9 3e }
        $s4 = { be [2] 68 00 bf [2] 40 00 e8 [2] ff ff 48 8d 45 c6 48 89 c7 e8 [2] ff ff 48 8d 55 c6 48 8d 45 b8 be [2] 46 00 48 89 c7 e8 4a 25 00 00 b9 [2] 68 00 48 8d 45 b8 ba 00 00 00 00 48 89 c6 48 89 cf e8 [2] ff ff 48 8d 45 b8 48 89 c7 e8 1f 22 00 00 48 8d 45 c6 48 89 c7 e8 [2] ff ff ba [2] 45 00 be [2] 68 00 bf [2] 40 00 e8 [2] ff ff be [2] 45 00 bf [2] 68 00 e8 f5 30 00 00 bb 00 00 00 00 }
	condition:
       uint32(0) == 0x464C457F and filesize > 300KB and all of ($s*) 
} 
