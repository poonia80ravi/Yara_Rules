rule win_crypmic_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.crypmic."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.crypmic"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8d4001 66890c17 8d1400 33db }
            // n = 4, score = 300
            //   8d4001               | lea                 eax, [eax + 1]
            //   66890c17             | mov                 word ptr [edi + edx], cx
            //   8d1400               | lea                 edx, [eax + eax]
            //   33db                 | xor                 ebx, ebx

        $sequence_1 = { 75ed 8b7dec ba5c000000 66891448 8d1c48 8d8d94fdffff }
            // n = 6, score = 300
            //   75ed                 | jne                 0xffffffef
            //   8b7dec               | mov                 edi, dword ptr [ebp - 0x14]
            //   ba5c000000           | mov                 edx, 0x5c
            //   66891448             | mov                 word ptr [eax + ecx*2], dx
            //   8d1c48               | lea                 ebx, [eax + ecx*2]
            //   8d8d94fdffff         | lea                 ecx, [ebp - 0x26c]

        $sequence_2 = { 0fb6c2 2bc1 74ec 46 3b75fc 770b 8b55f8 }
            // n = 7, score = 300
            //   0fb6c2               | movzx               eax, dl
            //   2bc1                 | sub                 eax, ecx
            //   74ec                 | je                  0xffffffee
            //   46                   | inc                 esi
            //   3b75fc               | cmp                 esi, dword ptr [ebp - 4]
            //   770b                 | ja                  0xd
            //   8b55f8               | mov                 edx, dword ptr [ebp - 8]

        $sequence_3 = { 83ec0c 53 8bc1 33c9 }
            // n = 4, score = 300
            //   83ec0c               | sub                 esp, 0xc
            //   53                   | push                ebx
            //   8bc1                 | mov                 eax, ecx
            //   33c9                 | xor                 ecx, ecx

        $sequence_4 = { 8d4002 46 66833800 75f6 8d3c72 }
            // n = 5, score = 300
            //   8d4002               | lea                 eax, [eax + 2]
            //   46                   | inc                 esi
            //   66833800             | cmp                 word ptr [eax], 0
            //   75f6                 | jne                 0xfffffff8
            //   8d3c72               | lea                 edi, [edx + esi*2]

        $sequence_5 = { 85f6 7410 8b55f8 33c0 8bcf 66894302 }
            // n = 6, score = 300
            //   85f6                 | test                esi, esi
            //   7410                 | je                  0x12
            //   8b55f8               | mov                 edx, dword ptr [ebp - 8]
            //   33c0                 | xor                 eax, eax
            //   8bcf                 | mov                 ecx, edi
            //   66894302             | mov                 word ptr [ebx + 2], ax

        $sequence_6 = { 83e828 8945fc 8b4508 8bd1 }
            // n = 4, score = 300
            //   83e828               | sub                 eax, 0x28
            //   8945fc               | mov                 dword ptr [ebp - 4], eax
            //   8b4508               | mov                 eax, dword ptr [ebp + 8]
            //   8bd1                 | mov                 edx, ecx

        $sequence_7 = { 33c9 56 8955fc 8945f4 }
            // n = 4, score = 300
            //   33c9                 | xor                 ecx, ecx
            //   56                   | push                esi
            //   8955fc               | mov                 dword ptr [ebp - 4], edx
            //   8945f4               | mov                 dword ptr [ebp - 0xc], eax

        $sequence_8 = { 33c9 33c0 663bcf 741f 0fb7cf }
            // n = 5, score = 300
            //   33c9                 | xor                 ecx, ecx
            //   33c0                 | xor                 eax, eax
            //   663bcf               | cmp                 cx, di
            //   741f                 | je                  0x21
            //   0fb7cf               | movzx               ecx, di

        $sequence_9 = { 81c2e0ff0000 8bc3 8d489f 6683f919 7705 }
            // n = 5, score = 300
            //   81c2e0ff0000         | add                 edx, 0xffe0
            //   8bc3                 | mov                 eax, ebx
            //   8d489f               | lea                 ecx, [eax - 0x61]
            //   6683f919             | cmp                 cx, 0x19
            //   7705                 | ja                  7

    condition:
        7 of them and filesize < 81920
}