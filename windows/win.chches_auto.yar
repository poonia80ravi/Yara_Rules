rule win_chches_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.chches."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.chches"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 50 ffd1 8b543bfc c7421000000000 8b4c3bfc 83c114 0f84a4000000 }
            // n = 7, score = 200
            //   50                   | push                eax
            //   ffd1                 | call                ecx
            //   8b543bfc             | mov                 edx, dword ptr [ebx + edi - 4]
            //   c7421000000000       | mov                 dword ptr [edx + 0x10], 0
            //   8b4c3bfc             | mov                 ecx, dword ptr [ebx + edi - 4]
            //   83c114               | add                 ecx, 0x14
            //   0f84a4000000         | je                  0xaa

        $sequence_1 = { 53 ffd2 50 8b4650 ffd0 8b0f 89590c }
            // n = 7, score = 200
            //   53                   | push                ebx
            //   ffd2                 | call                edx
            //   50                   | push                eax
            //   8b4650               | mov                 eax, dword ptr [esi + 0x50]
            //   ffd0                 | call                eax
            //   8b0f                 | mov                 ecx, dword ptr [edi]
            //   89590c               | mov                 dword ptr [ecx + 0xc], ebx

        $sequence_2 = { 8903 8b0e 8b5130 8b4a0c 8b5668 57 51 }
            // n = 7, score = 200
            //   8903                 | mov                 dword ptr [ebx], eax
            //   8b0e                 | mov                 ecx, dword ptr [esi]
            //   8b5130               | mov                 edx, dword ptr [ecx + 0x30]
            //   8b4a0c               | mov                 ecx, dword ptr [edx + 0xc]
            //   8b5668               | mov                 edx, dword ptr [esi + 0x68]
            //   57                   | push                edi
            //   51                   | push                ecx

        $sequence_3 = { 50 6a00 ffd1 8b5750 50 ffd2 8b45f4 }
            // n = 7, score = 200
            //   50                   | push                eax
            //   6a00                 | push                0
            //   ffd1                 | call                ecx
            //   8b5750               | mov                 edx, dword ptr [edi + 0x50]
            //   50                   | push                eax
            //   ffd2                 | call                edx
            //   8b45f4               | mov                 eax, dword ptr [ebp - 0xc]

        $sequence_4 = { ffd1 eb16 8b55f8 8d4c1601 8b5744 51 50 }
            // n = 7, score = 200
            //   ffd1                 | call                ecx
            //   eb16                 | jmp                 0x18
            //   8b55f8               | mov                 edx, dword ptr [ebp - 8]
            //   8d4c1601             | lea                 ecx, [esi + edx + 1]
            //   8b5744               | mov                 edx, dword ptr [edi + 0x44]
            //   51                   | push                ecx
            //   50                   | push                eax

        $sequence_5 = { 8b4014 8b5644 8d4f01 51 3bc3 750c 6a08 }
            // n = 7, score = 200
            //   8b4014               | mov                 eax, dword ptr [eax + 0x14]
            //   8b5644               | mov                 edx, dword ptr [esi + 0x44]
            //   8d4f01               | lea                 ecx, [edi + 1]
            //   51                   | push                ecx
            //   3bc3                 | cmp                 eax, ebx
            //   750c                 | jne                 0xe
            //   6a08                 | push                8

        $sequence_6 = { 8b464c ffd0 8b0f 8b54240c 89410c 8b4204 8b480c }
            // n = 7, score = 200
            //   8b464c               | mov                 eax, dword ptr [esi + 0x4c]
            //   ffd0                 | call                eax
            //   8b0f                 | mov                 ecx, dword ptr [edi]
            //   8b54240c             | mov                 edx, dword ptr [esp + 0xc]
            //   89410c               | mov                 dword ptr [ecx + 0xc], eax
            //   8b4204               | mov                 eax, dword ptr [edx + 4]
            //   8b480c               | mov                 ecx, dword ptr [eax + 0xc]

        $sequence_7 = { 0f847a000000 8b5510 8d4d10 51 8b4d0c 52 51 }
            // n = 7, score = 200
            //   0f847a000000         | je                  0x80
            //   8b5510               | mov                 edx, dword ptr [ebp + 0x10]
            //   8d4d10               | lea                 ecx, [ebp + 0x10]
            //   51                   | push                ecx
            //   8b4d0c               | mov                 ecx, dword ptr [ebp + 0xc]
            //   52                   | push                edx
            //   51                   | push                ecx

        $sequence_8 = { 3bcb 0f8484000000 8b4210 3bc3 }
            // n = 4, score = 200
            //   3bcb                 | cmp                 ecx, ebx
            //   0f8484000000         | je                  0x8a
            //   8b4210               | mov                 eax, dword ptr [edx + 0x10]
            //   3bc3                 | cmp                 eax, ebx

        $sequence_9 = { 57 6a00 ffd1 8b5650 50 ffd2 8bc3 }
            // n = 7, score = 200
            //   57                   | push                edi
            //   6a00                 | push                0
            //   ffd1                 | call                ecx
            //   8b5650               | mov                 edx, dword ptr [esi + 0x50]
            //   50                   | push                eax
            //   ffd2                 | call                edx
            //   8bc3                 | mov                 eax, ebx

    condition:
        7 of them and filesize < 122880
}