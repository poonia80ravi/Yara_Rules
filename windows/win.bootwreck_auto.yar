rule win_bootwreck_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.bootwreck."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.bootwreck"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { f5 f9 b877aefb86 e5d9 36ddb3ea66d9d7 ab }
            // n = 6, score = 100
            //   f5                   | cmc                 
            //   f9                   | stc                 
            //   b877aefb86           | mov                 eax, 0x86fbae77
            //   e5d9                 | in                  eax, 0xd9
            //   36ddb3ea66d9d7       | fnsave              dword ptr ss:[ebx - 0x28269916]
            //   ab                   | stosd               dword ptr es:[edi], eax

        $sequence_1 = { bd3cdb9a89 58 1f d6 cd7c 230a d938 }
            // n = 7, score = 100
            //   bd3cdb9a89           | mov                 ebp, 0x899adb3c
            //   58                   | pop                 eax
            //   1f                   | pop                 ds
            //   d6                   | salc                
            //   cd7c                 | int                 0x7c
            //   230a                 | and                 ecx, dword ptr [edx]
            //   d938                 | fnstcw              word ptr [eax]

        $sequence_2 = { b300 00a0d128c87a f7a7a50e3b9f 25ba7925ec 4b 92 268d2d7461ec33 }
            // n = 7, score = 100
            //   b300                 | mov                 bl, 0
            //   00a0d128c87a         | add                 byte ptr [eax + 0x7ac828d1], ah
            //   f7a7a50e3b9f         | mul                 dword ptr [edi - 0x60c4f15b]
            //   25ba7925ec           | and                 eax, 0xec2579ba
            //   4b                   | dec                 ebx
            //   92                   | xchg                eax, edx
            //   268d2d7461ec33       | lea                 ebp, es:[0x33ec6174]

        $sequence_3 = { 2648 5a 11785f dbea 2af9 48 9d }
            // n = 7, score = 100
            //   2648                 | dec                 eax
            //   5a                   | pop                 edx
            //   11785f               | adc                 dword ptr [eax + 0x5f], edi
            //   dbea                 | fucomi              st(2)
            //   2af9                 | sub                 bh, cl
            //   48                   | dec                 eax
            //   9d                   | popfd               

        $sequence_4 = { 68cefaf353 f8 85f6 60 683801e9de 8d642428 0f842d43ffff }
            // n = 7, score = 100
            //   68cefaf353           | push                0x53f3face
            //   f8                   | clc                 
            //   85f6                 | test                esi, esi
            //   60                   | pushal              
            //   683801e9de           | push                0xdee90138
            //   8d642428             | lea                 esp, [esp + 0x28]
            //   0f842d43ffff         | je                  0xffff4333

        $sequence_5 = { 660fbef2 660fce 8d9b6eb8b155 0fb6f2 89de 660fb6da 8d642434 }
            // n = 7, score = 100
            //   660fbef2             | movsx               si, dl
            //   660fce               | bswap               si
            //   8d9b6eb8b155         | lea                 ebx, [ebx + 0x55b1b86e]
            //   0fb6f2               | movzx               esi, dl
            //   89de                 | mov                 esi, ebx
            //   660fb6da             | movzx               bx, dl
            //   8d642434             | lea                 esp, [esp + 0x34]

        $sequence_6 = { 60 884c2410 8744242c 9c 8d642430 0f8411e10000 50 }
            // n = 7, score = 100
            //   60                   | pushal              
            //   884c2410             | mov                 byte ptr [esp + 0x10], cl
            //   8744242c             | xchg                dword ptr [esp + 0x2c], eax
            //   9c                   | pushfd              
            //   8d642430             | lea                 esp, [esp + 0x30]
            //   0f8411e10000         | je                  0xe117
            //   50                   | push                eax

        $sequence_7 = { d3fa f5 25ffffff7f c1e217 d2de 66d1e3 03412c }
            // n = 7, score = 100
            //   d3fa                 | sar                 edx, cl
            //   f5                   | cmc                 
            //   25ffffff7f           | and                 eax, 0x7fffffff
            //   c1e217               | shl                 edx, 0x17
            //   d2de                 | rcr                 dh, cl
            //   66d1e3               | shl                 bx, 1
            //   03412c               | add                 eax, dword ptr [ecx + 0x2c]

        $sequence_8 = { 60 bd???????? e8???????? 6689c5 660fcd 8daf7c6b0bd0 5d }
            // n = 7, score = 100
            //   60                   | pushal              
            //   bd????????           |                     
            //   e8????????           |                     
            //   6689c5               | mov                 bp, ax
            //   660fcd               | bswap               bp
            //   8daf7c6b0bd0         | lea                 ebp, [edi - 0x2ff49484]
            //   5d                   | pop                 ebp

        $sequence_9 = { 1d2d8332de 1555b37817 6e 8d21 58 a5 fc }
            // n = 7, score = 100
            //   1d2d8332de           | sbb                 eax, 0xde32832d
            //   1555b37817           | adc                 eax, 0x1778b355
            //   6e                   | outsb               dx, byte ptr [esi]
            //   8d21                 | lea                 esp, [ecx]
            //   58                   | pop                 eax
            //   a5                   | movsd               dword ptr es:[edi], dword ptr [esi]
            //   fc                   | cld                 

    condition:
        7 of them and filesize < 10821632
}