rule win_sdbbot_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.sdbbot."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.sdbbot"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 7521 8b45dc 0fb70e 8b401c }
            // n = 4, score = 700
            //   7521                 | dec                 eax
            //   8b45dc               | add                 eax, -0x20
            //   0fb70e               | dec                 eax
            //   8b401c               | add                 eax, ecx

        $sequence_1 = { 6685d2 75e4 81f95bbc4a6a 0f85cf000000 8b5dfc }
            // n = 5, score = 700
            //   6685d2               | mov                 esp, dword ptr [ecx + edx*4]
            //   75e4                 | movzx               ecx, byte ptr [edx]
            //   81f95bbc4a6a         | ror                 eax, 0xd
            //   0f85cf000000         | cmp                 cl, 0x61
            //   8b5dfc               | jb                  0xc

        $sequence_2 = { 7434 8b45f8 83c72c 8b4ff8 }
            // n = 4, score = 700
            //   7434                 | add                 edx, esi
            //   8b45f8               | xor                 eax, eax
            //   83c72c               | mov                 cl, byte ptr [edx]
            //   8b4ff8               | nop                 dword ptr [eax + eax]

        $sequence_3 = { 33c9 0fb75024 0f1f8000000000 0fb63e c1c90d }
            // n = 5, score = 700
            //   33c9                 | mov                 eax, dword ptr [ebp - 0x24]
            //   0fb75024             | test                dx, dx
            //   0f1f8000000000       | jne                 0xffffffe6
            //   0fb63e               | cmp                 ecx, 0x6a4abc5b
            //   c1c90d               | jne                 0xdd

        $sequence_4 = { 8b5df4 837de800 7416 837de400 7410 85db }
            // n = 6, score = 700
            //   8b5df4               | dec                 ebp
            //   837de800             | add                 ecx, edx
            //   7416                 | nop                 word ptr [eax + eax]
            //   837de400             | inc                 ecx
            //   7410                 | mov                 edx, dword ptr [eax]
            //   85db                 | mov                 edx, dword ptr [ebx]

        $sequence_5 = { 8a02 84c0 75ef 81f9b80a4c53 7521 8b45dc }
            // n = 6, score = 700
            //   8a02                 | add                 esi, ecx
            //   84c0                 | jmp                 0x34
            //   75ef                 | inc                 ecx
            //   81f9b80a4c53         | cmp                 eax, 0x7c0dfcaa
            //   7521                 | jne                 0x14
            //   8b45dc               | inc                 esp

        $sequence_6 = { 8b13 03d6 33c0 8a0a 0f1f840000000000 c1c80d }
            // n = 6, score = 700
            //   8b13                 | inc                 ecx
            //   03d6                 | cmp                 eax, 0x7c0dfcaa
            //   33c0                 | jne                 0x17
            //   8a0a                 | inc                 esp
            //   0f1f840000000000     | mov                 esp, dword ptr [ecx + edx*4]
            //   c1c80d               | dec                 ebp

        $sequence_7 = { c745e800000000 56 57 c745e400000000 }
            // n = 4, score = 700
            //   c745e800000000       | dec                 eax
            //   56                   | inc                 edx
            //   57                   | dec                 ebp
            //   c745e400000000       | add                 eax, edx

        $sequence_8 = { c3 803d????????00 750c c605????????01 }
            // n = 4, score = 400
            //   c3                   | ret                 
            //   803d????????00       |                     
            //   750c                 | jne                 0xe
            //   c605????????01       |                     

        $sequence_9 = { 4983c004 4983c102 664585db 75ac }
            // n = 4, score = 300
            //   4983c004             | inc                 ebp
            //   4983c102             | movzx               eax, word ptr [edi + 0x48]
            //   664585db             | nop                 dword ptr [eax + eax]
            //   75ac                 | movzx               ecx, byte ptr [edx]

        $sequence_10 = { 49d1ea 7475 6690 410fb713 49ffca }
            // n = 5, score = 300
            //   49d1ea               | xor                 ecx, ecx
            //   7475                 | movzx               edx, word ptr [eax + 0x24]
            //   6690                 | nop                 dword ptr [eax]
            //   410fb713             | movzx               edi, byte ptr [esi]
            //   49ffca               | ror                 ecx, 0xd

        $sequence_11 = { 4889742440 33db 4c89642430 33f6 4533e4 4c896c2428 33ed }
            // n = 7, score = 300
            //   4889742440           | dec                 eax
            //   33db                 | mov                 dword ptr [esp + 0x40], esi
            //   4c89642430           | xor                 ebx, ebx
            //   33f6                 | dec                 esp
            //   4533e4               | mov                 dword ptr [esp + 0x30], esp
            //   4c896c2428           | xor                 esi, esi
            //   33ed                 | inc                 ebp

        $sequence_12 = { 4d2b4f30 4c8b6c2428 4c8b642430 488b742440 488b6c2448 }
            // n = 5, score = 300
            //   4d2b4f30             | jne                 0xd
            //   4c8b6c2428           | and                 eax, 0xfff
            //   4c8b642430           | inc                 esi
            //   488b742440           | add                 dword ptr [eax + eax], ecx
            //   488b6c2448           | jmp                 0x36

        $sequence_13 = { 4885d2 7417 4d8bc6 4d2bc5 }
            // n = 4, score = 300
            //   4885d2               | dec                 eax
            //   7417                 | mov                 esi, dword ptr [esp + 0x40]
            //   4d8bc6               | dec                 eax
            //   4d2bc5               | mov                 ebp, dword ptr [esp + 0x48]

        $sequence_14 = { 448b3491 4d03f1 eb32 4181f8aafc0d7c 7509 448b2491 }
            // n = 6, score = 300
            //   448b3491             | ror                 eax, 0xd
            //   4d03f1               | cmp                 cl, 0x61
            //   eb32                 | jb                  0x14
            //   4181f8aafc0d7c       | dec                 eax
            //   7509                 | test                edx, edx
            //   448b2491             | je                  0x19

        $sequence_15 = { 450fb74748 0f1f440000 0fb60a c1c80d 80f961 7204 }
            // n = 6, score = 300
            //   450fb74748           | dec                 ebp
            //   0f1f440000           | sub                 ecx, dword ptr [edi + 0x30]
            //   0fb60a               | dec                 esp
            //   c1c80d               | mov                 ebp, dword ptr [esp + 0x28]
            //   80f961               | dec                 esp
            //   7204                 | mov                 esp, dword ptr [esp + 0x30]

        $sequence_16 = { 750b 25ff0f0000 46010c00 eb2b }
            // n = 4, score = 300
            //   750b                 | xor                 esp, esp
            //   25ff0f0000           | dec                 esp
            //   46010c00             | mov                 dword ptr [esp + 0x28], ebp
            //   eb2b                 | xor                 ebp, ebp

    condition:
        7 of them and filesize < 1015808
}