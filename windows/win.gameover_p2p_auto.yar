rule win_gameover_p2p_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.gameover_p2p."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.gameover_p2p"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8bc7 d3e0 c1ea03 8482806f3902 0f858afeffff }
            // n = 5, score = 100
            //   8bc7                 | mov                 eax, edi
            //   d3e0                 | shl                 eax, cl
            //   c1ea03               | shr                 edx, 3
            //   8482806f3902         | test                byte ptr [edx + 0x2396f80], al
            //   0f858afeffff         | jne                 0xfffffe90

        $sequence_1 = { 8b9c2434010000 55 56 bd64050000 8bf1 57 8954241c }
            // n = 7, score = 100
            //   8b9c2434010000       | mov                 ebx, dword ptr [esp + 0x134]
            //   55                   | push                ebp
            //   56                   | push                esi
            //   bd64050000           | mov                 ebp, 0x564
            //   8bf1                 | mov                 esi, ecx
            //   57                   | push                edi
            //   8954241c             | mov                 dword ptr [esp + 0x1c], edx

        $sequence_2 = { c20400 81ecc4040000 53 55 56 894c2428 }
            // n = 6, score = 100
            //   c20400               | ret                 4
            //   81ecc4040000         | sub                 esp, 0x4c4
            //   53                   | push                ebx
            //   55                   | push                ebp
            //   56                   | push                esi
            //   894c2428             | mov                 dword ptr [esp + 0x28], ecx

        $sequence_3 = { 3d00081948 0f821c010000 80642454fe 51 8bcd f7d9 }
            // n = 6, score = 100
            //   3d00081948           | cmp                 eax, 0x48190800
            //   0f821c010000         | jb                  0x122
            //   80642454fe           | and                 byte ptr [esp + 0x54], 0xfe
            //   51                   | push                ecx
            //   8bcd                 | mov                 ecx, ebp
            //   f7d9                 | neg                 ecx

        $sequence_4 = { ff751c 8bf9 8b4d0c c745f4e8923902 8975fc e8???????? }
            // n = 6, score = 100
            //   ff751c               | push                dword ptr [ebp + 0x1c]
            //   8bf9                 | mov                 edi, ecx
            //   8b4d0c               | mov                 ecx, dword ptr [ebp + 0xc]
            //   c745f4e8923902       | mov                 dword ptr [ebp - 0xc], 0x23992e8
            //   8975fc               | mov                 dword ptr [ebp - 4], esi
            //   e8????????           |                     

        $sequence_5 = { 85db 0f84ad010000 88542438 85ed }
            // n = 4, score = 100
            //   85db                 | test                ebx, ebx
            //   0f84ad010000         | je                  0x1b3
            //   88542438             | mov                 byte ptr [esp + 0x38], dl
            //   85ed                 | test                ebp, ebp

        $sequence_6 = { 8988bc160000 8b3cb538223902 8b5d08 85ff 0f8487fdffff 2b14b5702b3902 8b88bc160000 }
            // n = 7, score = 100
            //   8988bc160000         | mov                 dword ptr [eax + 0x16bc], ecx
            //   8b3cb538223902       | mov                 edi, dword ptr [esi*4 + 0x2392238]
            //   8b5d08               | mov                 ebx, dword ptr [ebp + 8]
            //   85ff                 | test                edi, edi
            //   0f8487fdffff         | je                  0xfffffd8d
            //   2b14b5702b3902       | sub                 edx, dword ptr [esi*4 + 0x2392b70]
            //   8b88bc160000         | mov                 ecx, dword ptr [eax + 0x16bc]

        $sequence_7 = { 8bcf e8???????? 53 ffb524020000 8bcf 53 ff742424 }
            // n = 7, score = 100
            //   8bcf                 | mov                 ecx, edi
            //   e8????????           |                     
            //   53                   | push                ebx
            //   ffb524020000         | push                dword ptr [ebp + 0x224]
            //   8bcf                 | mov                 ecx, edi
            //   53                   | push                ebx
            //   ff742424             | push                dword ptr [esp + 0x24]

        $sequence_8 = { 0f8e9d000000 83fe02 7e1d 83fe03 0f858f000000 8b842404060000 51 }
            // n = 7, score = 100
            //   0f8e9d000000         | jle                 0xa3
            //   83fe02               | cmp                 esi, 2
            //   7e1d                 | jle                 0x1f
            //   83fe03               | cmp                 esi, 3
            //   0f858f000000         | jne                 0x95
            //   8b842404060000       | mov                 eax, dword ptr [esp + 0x604]
            //   51                   | push                ecx

        $sequence_9 = { 46 81c7db010000 3bf5 72e0 8bf3 eb04 89742418 }
            // n = 7, score = 100
            //   46                   | inc                 esi
            //   81c7db010000         | add                 edi, 0x1db
            //   3bf5                 | cmp                 esi, ebp
            //   72e0                 | jb                  0xffffffe2
            //   8bf3                 | mov                 esi, ebx
            //   eb04                 | jmp                 6
            //   89742418             | mov                 dword ptr [esp + 0x18], esi

    condition:
        7 of them and filesize < 598016
}