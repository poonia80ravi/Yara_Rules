rule RAN_XYZconfig_Jan_2022_1
{
    meta:
        description = "Detect XYZconfig ransomware"
        author = "Arkbird_SOLG"
        date = "2022-01-07"
        reference = "https://id-ransomware.blogspot.com/2022/01/xyzconfig-ransomware.html"
        hash1 = "25d18c3823a3b210a18e69c823ce4c59fab298c315ac2a5d891027921d1c6d7e"
        tlp = "Clear"
        adversary = "-"
        level = "Experimental"
    strings:
        $s1 = { 48 8b 84 24 88 00 00 00 e8 7b e1 fd ff 48 8d 4c 24 50 44 0f 11 39 48 8d 54 24 60 44 0f 11 3a 48 8d 54 24 70 44 0f 11 3a 48 8b 15 59 74 1c 00 48 89 14 24 48 89 4c 24 08 48 89 4c 24 10 48 c7 44 24 18 30 00 00 00 66 90 e8 1b 05 00 00 45 0f 57 ff 65 4c 8b 34 25 28 00 00 00 4d 8b b6 00 00 00 00 48 83 7c 24 20 00 90 0f 84 88 00 00 00 48 8b 4c 24 58 48 8d 91 00 40 00 00 4c 89 b4 24 90 00 00 00 49 8b 76 08 66 90 48 39 d6 72 4e 48 29 ce 48 81 c6 00 c0 ff ff 48 81 fe 00 00 00 04 77 3b 49 89 16 48 8d 81 a0 53 00 00 49 89 46 10 49 89 46 18 e8 51 93 02 00 45 0f 57 ff 65 4c 8b 34 25 28 00 00 00 4d 8b b6 00 00 00 00 48 8b ac 24 98 00 00 00 48 81 c4 a0 00 00 00 c3 48 8b 8c 24 90 00 00 00 84 01 48 8d }
        $s2 = { 89 05 40 d4 23 00 48 8d 44 24 20 44 0f 11 38 48 8d 4c 24 30 44 0f 11 39 48 8d 4c 24 40 44 0f 11 39 48 8b 0d d2 89 1c 00 48 89 0c 24 48 89 44 24 08 e8 14 19 00 00 45 0f 57 ff 65 4c 8b 34 25 28 00 00 00 4d 8b b6 00 00 00 00 8b 44 24 24 48 89 05 2d d5 23 00 48 8b 05 4e 89 1c 00 48 89 04 24 48 c7 44 24 08 ff ff ff ff 48 c7 44 24 10 01 00 00 }
        $s3 = { 48 83 ec 48 48 89 6c 24 40 48 8d 6c 24 40 48 89 44 24 50 48 89 5c 24 58 48 83 3d 16 e6 23 00 00 75 73 48 8b 05 45 9a 1c 00 48 8d 0d 06 ee 23 00 48 89 04 24 48 89 4c 24 08 48 c7 44 24 10 04 01 00 00 e8 ef 29 00 00 45 0f 57 ff 65 4c 8b 34 25 28 00 00 00 4d 8b b6 00 00 00 00 48 8b 44 24 18 48 }
        $s4 = { 48 89 44 24 40 c7 44 24 3c 00 00 00 00 48 8b 0d ce 80 1c 00 48 8d 54 24 3c 48 89 0c 24 48 89 44 24 08 48 89 54 24 10 e8 4e 10 00 00 45 0f 57 ff 65 4c 8b 34 25 28 00 00 00 4d 8b b6 00 00 00 00 48 83 7c 24 18 00 75 10 48 8b 44 24 40 8b 4c 24 68 48 8b 5c 24 60 eb 1d 48 8b 44 24 40 48 8b 5c 24 60 8b 4c 24 68 e8 8f 00 00 00 48 8b 6c 24 48 48 83 c4 50 c3 c7 44 24 38 00 00 00 00 48 8b 15 76 7f 1c 00 48 8d 74 24 38 48 89 14 24 48 89 44 24 08 48 89 5c 24 10 48 63 c1 48 89 44 24 18 48 89 74 24 20 48 c7 44 24 28 }
    condition:
       uint16(0) == 0x5A4D and filesize > 300KB and all of ($s*) 
}  
