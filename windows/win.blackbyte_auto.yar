rule win_blackbyte_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.blackbyte."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.blackbyte"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 4c8d6424e0 4d3b6610 0f8692010000 4881eca0000000 4889ac2498000000 488dac2498000000 440f11bc2488000000 }
            // n = 7, score = 200
            //   4c8d6424e0           | mov                 dword ptr [esp + 0x50], edx
            //   4d3b6610             | dec                 eax
            //   0f8692010000         | mov                 ecx, dword ptr [esp + 0x40]
            //   4881eca0000000       | dec                 esp
            //   4889ac2498000000     | mov                 ebx, eax
            //   488dac2498000000     | nop                 word ptr [eax + eax]
            //   440f11bc2488000000     | dec    eax

        $sequence_1 = { e8???????? 4889f0 b902000000 e8???????? 89f8 b903000000 6690 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   4889f0               | dec                 eax
            //   b902000000           | test                ecx, ecx
            //   e8????????           |                     
            //   89f8                 | jne                 0x4ae
            //   b903000000           | dec                 eax
            //   6690                 | lea                 eax, [0x207eba]

        $sequence_2 = { 440fb6ac2499000000 44886c2447 440fb6ac249a000000 44886c2446 440fb6ac249b000000 44886c2445 440fb6ac249c000000 }
            // n = 7, score = 200
            //   440fb6ac2499000000     | sub    edx, eax
            //   44886c2447           | mov                 byte ptr [eax], dl
            //   440fb6ac249a000000     | movzx    edx, byte ptr [esp + 0x77]
            //   44886c2446           | inc                 esp
            //   440fb6ac249b000000     | movzx    eax, byte ptr [esp + 0x78]
            //   44886c2445           | inc                 esp
            //   440fb6ac249c000000     | xor    edx, eax

        $sequence_3 = { e8???????? 4c8d4301 488b5c2440 488b742450 4889c2 488b442448 c6040235 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   4c8d4301             | dec                 eax
            //   488b5c2440           | lea                 eax, [0x1067ea]
            //   488b742450           | dec                 eax
            //   4889c2               | mov                 ecx, ebx
            //   488b442448           | dec                 eax
            //   c6040235             | mov                 ebx, edi

        $sequence_4 = { 49c1eb12 4983e33f 450fb61c3b 4c39c9 0f86ca010000 46881c0b 4d8d5901 }
            // n = 7, score = 200
            //   49c1eb12             | ret                 
            //   4983e33f             | xor                 eax, eax
            //   450fb61c3b           | dec                 eax
            //   4c39c9               | lea                 ebx, [0x1cf415]
            //   0f86ca010000         | dec                 eax
            //   46881c0b             | mov                 edi, ecx
            //   4d8d5901             | dec                 eax

        $sequence_5 = { 4889d8 e8???????? 4c89c8 4889f1 e8???????? 4889d8 4c89d1 }
            // n = 7, score = 200
            //   4889d8               | mov                 byte ptr [esp + 0x49], ch
            //   e8????????           |                     
            //   4c89c8               | inc                 esp
            //   4889f1               | movzx               ebp, byte ptr [esp + 0x73]
            //   e8????????           |                     
            //   4889d8               | inc                 esp
            //   4c89d1               | mov                 byte ptr [esp + 0x48], ch

        $sequence_6 = { b8f9ffffff ffd1 488b08 4889c2 b8e8ffffff ffd1 488b08 }
            // n = 7, score = 200
            //   b8f9ffffff           | dec                 eax
            //   ffd1                 | mov                 edx, eax
            //   488b08               | dec                 eax
            //   4889c2               | mov                 eax, dword ptr [esp + 0x50]
            //   b8e8ffffff           | mov                 byte ptr [edx + eax], 0x54
            //   ffd1                 | inc                 ecx
            //   488b08               | mov                 eax, 8

        $sequence_7 = { b80a000000 ffd1 488b08 4889c2 b815000000 ffd1 488b08 }
            // n = 7, score = 200
            //   b80a000000           | mov                 edi, esi
            //   ffd1                 | dec                 esp
            //   488b08               | mov                 esi, eax
            //   4889c2               | dec                 esp
            //   b815000000           | lea                 eax, [ebx + 1]
            //   ffd1                 | dec                 eax
            //   488b08               | lea                 eax, [0x21b7d3]

        $sequence_8 = { 48c744242800000000 440f117c2438 48c744243000000000 e8???????? 4885ff 7404 31c0 }
            // n = 7, score = 200
            //   48c744242800000000     | dec    eax
            //   440f117c2438         | mov                 eax, dword ptr [esp + 0x40]
            //   48c744243000000000     | mov    word ptr [edi + ebx], 0xa0d2
            //   e8????????           |                     
            //   4885ff               | mov                 ecx, 6
            //   7404                 | dec                 ecx
            //   31c0                 | cmp                 eax, 0x16

        $sequence_9 = { 488d0d05010000 48894c2468 4889442470 488d4c2468 48898c2488000000 c644242703 e8???????? }
            // n = 7, score = 200
            //   488d0d05010000       | dec                 eax
            //   48894c2468           | lea                 ebp, [esp + 0x28]
            //   4889442470           | mov                 dword ptr [esp + 0x22], 0x6fa17724
            //   488d4c2468           | mov                 word ptr [esp + 0x26], 0xb6ca
            //   48898c2488000000     | mov                 dword ptr [esp + 0x1c], 0x1bcf1e51
            //   c644242703           | mov                 word ptr [esp + 0x20], 0x80fb
            //   e8????????           |                     

    condition:
        7 of them and filesize < 9435136
}