rule win_misfox_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.misfox."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.misfox"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8b45b8 52 c70300000000 40 ff37 8945b8 53 }
            // n = 7, score = 300
            //   8b45b8               | xor                 edx, edx
            //   52                   | mov                 eax, dword ptr [ebx + 0xc]
            //   c70300000000         | dec                 esp
            //   40                   | lea                 esp, [edi + 8]
            //   ff37                 | dec                 esp
            //   8945b8               | lea                 eax, [0x935f]
            //   53                   | cmp                 byte ptr [esp + 0x98], cl

        $sequence_1 = { 8d8decfbffff e8???????? 8b95ecfbffff 83c404 83bde8fbffff00 8bb5f0fbffff }
            // n = 6, score = 300
            //   8d8decfbffff         | sete                cl
            //   e8????????           |                     
            //   8b95ecfbffff         | dec                 eax
            //   83c404               | add                 ebx, ecx
            //   83bde8fbffff00       | dec                 eax
            //   8bb5f0fbffff         | sub                 edi, ebx

        $sequence_2 = { c705????????01000000 c705????????01000000 6a04 58 6bc000 8b4d08 8988ac830110 }
            // n = 7, score = 300
            //   c705????????01000000     |     
            //   c705????????01000000     |     
            //   6a04                 | test                eax, eax
            //   58                   | lea                 edi, [ebx + 8]
            //   6bc000               | mov                 esi, edi
            //   8b4d08               | mov                 dword ptr [esi], eax
            //   8988ac830110         | lea                 esi, [esi + 4]

        $sequence_3 = { 8d7b08 8bf7 8906 8d7604 40 }
            // n = 5, score = 300
            //   8d7b08               | dec                 eax
            //   8bf7                 | lea                 edx, [ebp + 0xd0]
            //   8906                 | xor                 ecx, ecx
            //   8d7604               | dec                 eax
            //   40                   | mov                 ecx, dword ptr [edi]

        $sequence_4 = { 53 8b149550870110 898d24e5ffff 8a5c1124 02db d0fb 80fb02 }
            // n = 7, score = 300
            //   53                   | inc                 eax
            //   8b149550870110       | mov                 eax, dword ptr [ebp - 0x48]
            //   898d24e5ffff         | push                edx
            //   8a5c1124             | mov                 dword ptr [ebx], 0
            //   02db                 | inc                 eax
            //   d0fb                 | push                dword ptr [edi]
            //   80fb02               | mov                 dword ptr [ebp - 0x48], eax

        $sequence_5 = { c645f40d 50 8b8528e5ffff 8b048550870110 ff3401 ff15???????? }
            // n = 6, score = 300
            //   c645f40d             | inc                 esi
            //   50                   | dec                 esp
            //   8b8528e5ffff         | lea                 ecx, [ebx + 8]
            //   8b048550870110       | inc                 ecx
            //   ff3401               | mov                 edx, esi
            //   ff15????????         |                     

        $sequence_6 = { ff74247c 0f43442470 8d8c2488000000 83bc249c00000010 8b942498000000 }
            // n = 5, score = 300
            //   ff74247c             | dec                 eax
            //   0f43442470           | mov                 dword ptr [esp + 0x20], ecx
            //   8d8c2488000000       | dec                 eax
            //   83bc249c00000010     | mov                 ecx, dword ptr [esp + 0x40]
            //   8b942498000000       | inc                 ecx

        $sequence_7 = { c705????????31960010 a3???????? c705????????c2960010 c705????????1c970010 c705????????a1970010 a3???????? c705????????668d0010 }
            // n = 7, score = 300
            //   c705????????31960010     |     
            //   a3????????           |                     
            //   c705????????c2960010     |     
            //   c705????????1c970010     |     
            //   c705????????a1970010     |     
            //   a3????????           |                     
            //   c705????????668d0010     |     

        $sequence_8 = { 488d0517580100 eb04 4883c014 8938 e8???????? 488d1dff570100 4885c0 }
            // n = 7, score = 100
            //   488d0517580100       | jmp                 0x17
            //   eb04                 | dec                 eax
            //   4883c014             | lea                 eax, [0x15817]
            //   8938                 | jmp                 6
            //   e8????????           |                     
            //   488d1dff570100       | dec                 eax
            //   4885c0               | add                 eax, 0x14

        $sequence_9 = { 4c89742430 4c8d4de7 4c8d45ff 488d55ef }
            // n = 4, score = 100
            //   4c89742430           | mov                 dword ptr [eax], edi
            //   4c8d4de7             | dec                 eax
            //   4c8d45ff             | lea                 ebx, [0x157ff]
            //   488d55ef             | dec                 eax

        $sequence_10 = { 7333 c6440c3800 807c243800 7412 488d442438 4883ceff 48ffc6 }
            // n = 7, score = 100
            //   7333                 | dec                 esp
            //   c6440c3800           | lea                 eax, [ebp - 1]
            //   807c243800           | dec                 eax
            //   7412                 | lea                 edx, [ebp - 0x11]
            //   488d442438           | dec                 eax
            //   4883ceff             | mov                 ecx, dword ptr [ebx + 0xa0]
            //   48ffc6               | dec                 eax

        $sequence_11 = { 4489642420 e8???????? 83f801 7506 0fb65530 eb15 }
            // n = 6, score = 100
            //   4489642420           | inc                 esp
            //   e8????????           |                     
            //   83f801               | mov                 dword ptr [esp + 0x20], esp
            //   7506                 | cmp                 eax, 1
            //   0fb65530             | jne                 8
            //   eb15                 | movzx               edx, byte ptr [ebp + 0x30]

        $sequence_12 = { e8???????? 488b8ba0000000 488d057bc50000 483bc8 7405 e8???????? bf0d000000 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   488b8ba0000000       | test                eax, eax
            //   488d057bc50000       | dec                 esp
            //   483bc8               | mov                 dword ptr [esp + 0x30], esi
            //   7405                 | dec                 esp
            //   e8????????           |                     
            //   bf0d000000           | lea                 ecx, [ebp - 0x19]

        $sequence_13 = { 488b0f 33d2 e8???????? 8b430c 4c8d6708 }
            // n = 5, score = 100
            //   488b0f               | mov                 edi, 0xd
            //   33d2                 | jae                 0x35
            //   e8????????           |                     
            //   8b430c               | mov                 byte ptr [esp + ecx + 0x38], 0
            //   4c8d6708             | cmp                 byte ptr [esp + 0x38], 0

        $sequence_14 = { 4533c9 4533c0 488d95d0000000 33c9 ff15???????? }
            // n = 5, score = 100
            //   4533c9               | lea                 eax, [0xc57b]
            //   4533c0               | dec                 eax
            //   488d95d0000000       | cmp                 ecx, eax
            //   33c9                 | je                  0xa
            //   ff15????????         |                     

        $sequence_15 = { 4c8d055f930000 388c2498000000 0f94c1 4803d9 482bfb }
            // n = 5, score = 100
            //   4c8d055f930000       | je                  0x19
            //   388c2498000000       | dec                 eax
            //   0f94c1               | lea                 eax, [esp + 0x38]
            //   4803d9               | dec                 eax
            //   482bfb               | or                  esi, 0xffffffff

    condition:
        7 of them and filesize < 266240
}