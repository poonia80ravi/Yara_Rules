rule win_highnote_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.highnote."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.highnote"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 53 1f 626c26e5 9e 51 55 fc }
            // n = 7, score = 200
            //   53                   | push                ebx
            //   1f                   | pop                 ds
            //   626c26e5             | bound               ebp, qword ptr [esi - 0x1b]
            //   9e                   | sahf                
            //   51                   | push                ecx
            //   55                   | push                ebp
            //   fc                   | cld                 

        $sequence_1 = { 02e6 07 75de d97e3b 8d1b d6 07 }
            // n = 7, score = 200
            //   02e6                 | add                 ah, dh
            //   07                   | pop                 es
            //   75de                 | jne                 0xffffffe0
            //   d97e3b               | fnstcw              word ptr [esi + 0x3b]
            //   8d1b                 | lea                 ebx, [ebx]
            //   d6                   | salc                
            //   07                   | pop                 es

        $sequence_2 = { 81e1ff000080 9c f605????????25 0f8528010000 2a81f049558d 54 f613 }
            // n = 7, score = 200
            //   81e1ff000080         | and                 ecx, 0x800000ff
            //   9c                   | pushfd              
            //   f605????????25       |                     
            //   0f8528010000         | jne                 0x12e
            //   2a81f049558d         | sub                 al, byte ptr [ecx - 0x72aab610]
            //   54                   | push                esp
            //   f613                 | not                 byte ptr [ebx]

        $sequence_3 = { f2ac 35eb847e1c 7e6d e20e 36d2d1 a8d2 3f }
            // n = 7, score = 200
            //   f2ac                 | repne lodsb         al, byte ptr [esi]
            //   35eb847e1c           | xor                 eax, 0x1c7e84eb
            //   7e6d                 | jle                 0x6f
            //   e20e                 | loop                0x10
            //   36d2d1               | rcl                 cl, cl
            //   a8d2                 | test                al, 0xd2
            //   3f                   | aas                 

        $sequence_4 = { 6d ba367f786d a4 77b6 624817 b36b 245e }
            // n = 7, score = 200
            //   6d                   | insd                dword ptr es:[edi], dx
            //   ba367f786d           | mov                 edx, 0x6d787f36
            //   a4                   | movsb               byte ptr es:[edi], byte ptr [esi]
            //   77b6                 | ja                  0xffffffb8
            //   624817               | bound               ecx, qword ptr [eax + 0x17]
            //   b36b                 | mov                 bl, 0x6b
            //   245e                 | and                 al, 0x5e

        $sequence_5 = { 4e a0???????? ee 02f9 a3???????? 3e44 }
            // n = 6, score = 200
            //   4e                   | dec                 esi
            //   a0????????           |                     
            //   ee                   | out                 dx, al
            //   02f9                 | add                 bh, cl
            //   a3????????           |                     
            //   3e44                 | inc                 esp

        $sequence_6 = { 236f23 3ba1b886ebb5 c57576 7cd4 91 d9bb4120dacb ee }
            // n = 7, score = 200
            //   236f23               | and                 ebp, dword ptr [edi + 0x23]
            //   3ba1b886ebb5         | cmp                 esp, dword ptr [ecx - 0x4a147948]
            //   c57576               | lds                 esi, ptr [ebp + 0x76]
            //   7cd4                 | jl                  0xffffffd6
            //   91                   | xchg                eax, ecx
            //   d9bb4120dacb         | fnstcw              word ptr [ebx - 0x3425dfbf]
            //   ee                   | out                 dx, al

        $sequence_7 = { e8???????? 83c40c 85c0 0f841d020000 68???????? 68???????? 6a00 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   85c0                 | test                eax, eax
            //   0f841d020000         | je                  0x223
            //   68????????           |                     
            //   68????????           |                     
            //   6a00                 | push                0

        $sequence_8 = { 127db2 92 2693 4d f725???????? 93 }
            // n = 6, score = 200
            //   127db2               | adc                 bh, byte ptr [ebp - 0x4e]
            //   92                   | xchg                eax, edx
            //   2693                 | xchg                eax, ebx
            //   4d                   | dec                 ebp
            //   f725????????         |                     
            //   93                   | xchg                eax, ebx

        $sequence_9 = { 8c5804 7267 1097d804306f 1f 2096608f9190 008e5278e71f 7586 }
            // n = 7, score = 200
            //   8c5804               | mov                 word ptr [eax + 4], ds
            //   7267                 | jb                  0x69
            //   1097d804306f         | adc                 byte ptr [edi + 0x6f3004d8], dl
            //   1f                   | pop                 ds
            //   2096608f9190         | and                 byte ptr [esi - 0x6f6e70a0], dl
            //   008e5278e71f         | add                 byte ptr [esi + 0x1fe77852], cl
            //   7586                 | jne                 0xffffff88

    condition:
        7 of them and filesize < 321536
}