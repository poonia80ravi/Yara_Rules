rule win_ksl0t_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.ksl0t."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.ksl0t"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 888c241e010000 c644246816 c644246939 8854246a c644246b26 }
            // n = 5, score = 200
            //   888c241e010000       | mov                 byte ptr [esp + 0x11e], cl
            //   c644246816           | mov                 byte ptr [esp + 0x68], 0x16
            //   c644246939           | mov                 byte ptr [esp + 0x69], 0x39
            //   8854246a             | mov                 byte ptr [esp + 0x6a], dl
            //   c644246b26           | mov                 byte ptr [esp + 0x6b], 0x26

        $sequence_1 = { ff15???????? 83c448 8b0d???????? be01000000 3bce }
            // n = 5, score = 200
            //   ff15????????         |                     
            //   83c448               | add                 esp, 0x48
            //   8b0d????????         |                     
            //   be01000000           | mov                 esi, 1
            //   3bce                 | cmp                 ecx, esi

        $sequence_2 = { 488b442430 0fb700 85c0 7426 488b442430 0fb700 }
            // n = 6, score = 200
            //   488b442430           | je                  0x9d0
            //   0fb700               | dec                 eax
            //   85c0                 | mov                 eax, dword ptr [esp + 0x50]
            //   7426                 | mov                 edx, dword ptr [esp + 0x1620]
            //   488b442430           | dec                 eax
            //   0fb700               | mov                 ecx, dword ptr [esp + 0x15f0]

        $sequence_3 = { 44895d08 44895d0c 66f3ab 488d3d127a0000 482bfd 8a041f }
            // n = 6, score = 200
            //   44895d08             | rep stosb           byte ptr es:[edi], al
            //   44895d0c             | inc                 esp
            //   66f3ab               | mov                 dword ptr [ebp + 8], ebx
            //   488d3d127a0000       | inc                 esp
            //   482bfd               | mov                 dword ptr [ebp + 0xc], ebx
            //   8a041f               | rep stosd           dword ptr es:[edi], eax

        $sequence_4 = { 88842401010000 889c2402010000 c684240301000002 c68424040100003c c68424050100003b c684240601000031 }
            // n = 6, score = 200
            //   88842401010000       | mov                 byte ptr [esp + 0x101], al
            //   889c2402010000       | mov                 byte ptr [esp + 0x102], bl
            //   c684240301000002     | mov                 byte ptr [esp + 0x103], 2
            //   c68424040100003c     | mov                 byte ptr [esp + 0x104], 0x3c
            //   c68424050100003b     | mov                 byte ptr [esp + 0x105], 0x3b
            //   c684240601000031     | mov                 byte ptr [esp + 0x106], 0x31

        $sequence_5 = { 488b442450 83780436 0f84c6090000 488b442450 }
            // n = 4, score = 200
            //   488b442450           | dec                 eax
            //   83780436             | lea                 edi, [0x7a12]
            //   0f84c6090000         | dec                 eax
            //   488b442450           | sub                 edi, ebp

        $sequence_6 = { c684242c01000010 c684242d0100002d 888c242e010000 c68424cc01000006 888424cd010000 889c24ce010000 }
            // n = 6, score = 200
            //   c684242c01000010     | mov                 byte ptr [esp + 0x12c], 0x10
            //   c684242d0100002d     | mov                 byte ptr [esp + 0x12d], 0x2d
            //   888c242e010000       | mov                 byte ptr [esp + 0x12e], cl
            //   c68424cc01000006     | mov                 byte ptr [esp + 0x1cc], 6
            //   888424cd010000       | mov                 byte ptr [esp + 0x1cd], al
            //   889c24ce010000       | mov                 byte ptr [esp + 0x1ce], bl

        $sequence_7 = { 50 57 8b5de4 8b03 50 }
            // n = 5, score = 200
            //   50                   | push                eax
            //   57                   | push                edi
            //   8b5de4               | mov                 ebx, dword ptr [ebp - 0x1c]
            //   8b03                 | mov                 eax, dword ptr [ebx]
            //   50                   | push                eax

        $sequence_8 = { 8d8d00100000 51 68???????? ff15???????? 83c428 }
            // n = 5, score = 200
            //   8d8d00100000         | lea                 ecx, [ebp + 0x1000]
            //   51                   | push                ecx
            //   68????????           |                     
            //   ff15????????         |                     
            //   83c428               | add                 esp, 0x28

        $sequence_9 = { 50 0fb74dd0 51 0fb755d2 52 }
            // n = 5, score = 200
            //   50                   | push                eax
            //   0fb74dd0             | movzx               ecx, word ptr [ebp - 0x30]
            //   51                   | push                ecx
            //   0fb755d2             | movzx               edx, word ptr [ebp - 0x2e]
            //   52                   | push                edx

        $sequence_10 = { 2bc1 56 57 89442418 bf???????? bb???????? bd???????? }
            // n = 7, score = 200
            //   2bc1                 | sub                 eax, ecx
            //   56                   | push                esi
            //   57                   | push                edi
            //   89442418             | mov                 dword ptr [esp + 0x18], eax
            //   bf????????           |                     
            //   bb????????           |                     
            //   bd????????           |                     

        $sequence_11 = { 8b942420160000 488b0d???????? ff15???????? 488b8c24f0150000 4833cc e8???????? 4881c408160000 }
            // n = 7, score = 200
            //   8b942420160000       | mov                 al, byte ptr [edi + ebx]
            //   488b0d????????       |                     
            //   ff15????????         |                     
            //   488b8c24f0150000     | dec                 eax
            //   4833cc               | mov                 eax, dword ptr [esp + 0x50]
            //   e8????????           |                     
            //   4881c408160000       | cmp                 dword ptr [eax + 4], 0x36

        $sequence_12 = { 33c0 b9fe030000 f3aa c784247004000000000000 }
            // n = 4, score = 200
            //   33c0                 | dec                 eax
            //   b9fe030000           | xor                 ecx, esp
            //   f3aa                 | dec                 eax
            //   c784247004000000000000     | add    esp, 0x1608

        $sequence_13 = { 33c0 66898424b0020000 488dbc24b2020000 33c0 b906020000 f3aa }
            // n = 6, score = 200
            //   33c0                 | xor                 eax, eax
            //   66898424b0020000     | mov                 word ptr [esp + 0x2b0], ax
            //   488dbc24b2020000     | dec                 eax
            //   33c0                 | lea                 edi, [esp + 0x2b2]
            //   b906020000           | xor                 eax, eax
            //   f3aa                 | mov                 ecx, 0x206

        $sequence_14 = { 488d0db9e30000 ff15???????? e9???????? 488d15e7c00000 4881c244010000 41b804000000 488d0d93e30000 }
            // n = 7, score = 200
            //   488d0db9e30000       | dec                 eax
            //   ff15????????         |                     
            //   e9????????           |                     
            //   488d15e7c00000       | mov                 eax, dword ptr [esp + 0x30]
            //   4881c244010000       | movzx               eax, word ptr [eax]
            //   41b804000000         | test                eax, eax
            //   488d0d93e30000       | je                  0x2a

        $sequence_15 = { 0f8537010000 4881bc242816000001010000 0f8525010000 488b442450 8138a1000000 742b 488b442450 }
            // n = 7, score = 200
            //   0f8537010000         | dec                 eax
            //   4881bc242816000001010000     | mov    eax, dword ptr [esp + 0x30]
            //   0f8525010000         | movzx               eax, word ptr [eax]
            //   488b442450           | xor                 eax, eax
            //   8138a1000000         | mov                 ecx, 0x3fe
            //   742b                 | rep stosb           byte ptr es:[edi], al
            //   488b442450           | mov                 dword ptr [esp + 0x470], 0

    condition:
        7 of them and filesize < 196608
}