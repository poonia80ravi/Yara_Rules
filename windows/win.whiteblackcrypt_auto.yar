rule win_whiteblackcrypt_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.whiteblackcrypt."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.whiteblackcrypt"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 48ffc0 4883f810 75ed 0f118fb0000000 4883c310 ebc4 }
            // n = 6, score = 100
            //   48ffc0               | dec                 eax
            //   4883f810             | test                eax, eax
            //   75ed                 | je                  0x2e0
            //   0f118fb0000000       | mov                 edx, 0x5c
            //   4883c310             | mov                 word ptr [ebx], dx
            //   ebc4                 | dec                 ecx

        $sequence_1 = { 4131c7 44327c243a 44327c243b 4531fc 448863fe 40326c243e }
            // n = 6, score = 100
            //   4131c7               | dec                 esp
            //   44327c243a           | mov                 dword ptr [esp + 0x40], eax
            //   44327c243b           | dec                 esp
            //   4531fc               | mov                 eax, dword ptr [esp + 0x40]
            //   448863fe             | inc                 ecx
            //   40326c243e           | movups              xmm0, xmmword ptr [eax]

        $sequence_2 = { 488d0d6d1d0000 ff15???????? 488b15???????? 488902 e8???????? 488d0d91fdffff }
            // n = 6, score = 100
            //   488d0d6d1d0000       | sete                al
            //   ff15????????         |                     
            //   488b15????????       |                     
            //   488902               | mov                 esi, ecx
            //   e8????????           |                     
            //   488d0d91fdffff       | or                  esi, eax

        $sequence_3 = { 488d542420 4c89e1 41c6442cff00 e8???????? }
            // n = 4, score = 100
            //   488d542420           | dec                 esp
            //   4c89e1               | mov                 edi, ebp
            //   41c6442cff00         | dec                 eax
            //   e8????????           |                     

        $sequence_4 = { 4889f2 e8???????? 660f2ec7 7a06 0f84f7fdffff 660f5735???????? }
            // n = 6, score = 100
            //   4889f2               | cmp                 edx, 1
            //   e8????????           |                     
            //   660f2ec7             | je                  0x19c3
            //   7a06                 | test                dl, 1
            //   0f84f7fdffff         | test                edx, edx
            //   660f5735????????     |                     

        $sequence_5 = { 57 56 53 4883ec28 488d0d41670000 ff15???????? 488b1d???????? }
            // n = 7, score = 100
            //   57                   | dec                 esp
            //   56                   | mov                 ecx, ebp
            //   53                   | je                  0x158a
            //   4883ec28             | ja                  0x1547
            //   488d0d41670000       | cmp                 edx, 1
            //   ff15????????         |                     
            //   488b1d????????       |                     

        $sequence_6 = { 4489c9 31e9 324c243e 31f9 31d1 4431d1 4431e9 }
            // n = 7, score = 100
            //   4489c9               | mov                 edx, esi
            //   31e9                 | jmp                 0xf2a
            //   324c243e             | movups              xmm0, xmmword ptr [edx]
            //   31f9                 | dec                 eax
            //   31d1                 | mov                 ecx, esi
            //   4431d1               | test                eax, eax
            //   4431e9               | je                  0xf69

        $sequence_7 = { 4c01cb 3c5c 7496 3c2f 7492 ba5c000000 668913 }
            // n = 7, score = 100
            //   4c01cb               | jns                 0xb6d
            //   3c5c                 | dec                 eax
            //   7496                 | btc                 edi, 0x3f
            //   3c2f                 | ucomisd             xmm0, xmm7
            //   7492                 | jp                  0xd46
            //   ba5c000000           | je                  0xb3d
            //   668913               | test                ebx, ebx

        $sequence_8 = { 75dc 488d0df5660000 4883c428 5b }
            // n = 4, score = 100
            //   75dc                 | jne                 0x1e2
            //   488d0df5660000       | dec                 eax
            //   4883c428             | mov                 dword ptr [ebx + 0x238], 0xffffffff
            //   5b                   | dec                 eax

        $sequence_9 = { 4989f0 4c89da e8???????? ffc3 e9???????? 4989f0 4c89da }
            // n = 7, score = 100
            //   4989f0               | movd                mm5, edi
            //   4c89da               | movsd               qword ptr [esp + 0x30], xmm5
            //   e8????????           |                     
            //   ffc3                 | jp                  0xc89
            //   e9????????           |                     
            //   4989f0               | je                  0xe4c
            //   4c89da               | dec                 eax

    condition:
        7 of them and filesize < 99328
}