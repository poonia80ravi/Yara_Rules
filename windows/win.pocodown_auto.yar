rule win_pocodown_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.pocodown."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.pocodown"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { eb15 498b442408 48898424d8000000 488d8424d8000000 488b00 483b4610 0f848f000000 }
            // n = 7, score = 200
            //   eb15                 | mov                 ecx, dword ptr [esp + 0x20]
            //   498b442408           | dec                 eax
            //   48898424d8000000     | lea                 eax, [eax + ecx + 4]
            //   488d8424d8000000     | dec                 esp
            //   488b00               | mov                 eax, dword ptr [esp + 0x28]
            //   483b4610             | dec                 eax
            //   0f848f000000         | mov                 edx, dword ptr [esp + 0x48]

        $sequence_1 = { ff542438 85c0 7507 33c0 e9???????? e9???????? 488b8424d0000000 }
            // n = 7, score = 200
            //   ff542438             | dec                 esp
            //   85c0                 | lea                 eax, [esp + 0x12c]
            //   7507                 | dec                 eax
            //   33c0                 | lea                 edx, [esp + 0x130]
            //   e9????????           |                     
            //   e9????????           |                     
            //   488b8424d0000000     | dec                 eax

        $sequence_2 = { ffc8 4898 488b8c24b8000000 c60401bc c784249000000001000000 4883bc248800000000 740d }
            // n = 7, score = 200
            //   ffc8                 | mov                 eax, dword ptr [esp + 0x60]
            //   4898                 | dec                 eax
            //   488b8c24b8000000     | mov                 dword ptr [esp + 0x30], eax
            //   c60401bc             | dec                 eax
            //   c784249000000001000000     | mov    eax, dword ptr [esp + 0x30]
            //   4883bc248800000000     | movzx    eax, byte ptr [eax]
            //   740d                 | mov                 dword ptr [esp + 0x44], eax

        $sequence_3 = { eb76 0fb7442434 3d74330000 7533 488b8424f0000000 488b8080000000 83b81003000000 }
            // n = 7, score = 200
            //   eb76                 | cmp                 dword ptr [esp + 0x60], 0
            //   0fb7442434           | je                  0x493
            //   3d74330000           | dec                 eax
            //   7533                 | mov                 ecx, dword ptr [esp + 0x60]
            //   488b8424f0000000     | dec                 eax
            //   488b8080000000       | mov                 eax, dword ptr [esp + 0x50]
            //   83b81003000000       | dec                 eax

        $sequence_4 = { b838000000 e8???????? 482be0 488b442440 48833800 0f8488000000 c744242000000000 }
            // n = 7, score = 200
            //   b838000000           | cmp                 esi, ebx
            //   e8????????           |                     
            //   482be0               | je                  0x18c3
            //   488b442440           | dec                 eax
            //   48833800             | mov                 eax, dword ptr [ebx + 8]
            //   0f8488000000         | dec                 eax
            //   c744242000000000     | mov                 ecx, dword ptr [esi + 8]

        $sequence_5 = { eb78 eb0e 488b4c2450 e8???????? 89442420 488d0567031800 4889442428 }
            // n = 7, score = 200
            //   eb78                 | jne                 0x80b
            //   eb0e                 | jmp                 0x813
            //   488b4c2450           | mov                 dword ptr [esp + 0x30], 1
            //   e8????????           |                     
            //   89442420             | dec                 eax
            //   488d0567031800       | mov                 eax, dword ptr [esp + 0x50]
            //   4889442428           | dec                 eax

        $sequence_6 = { f7d8 39442468 7e15 8b442458 39442468 7d0b 8b442468 }
            // n = 7, score = 200
            //   f7d8                 | lea                 eax, [eax + ecx - 0x30]
            //   39442468             | dec                 eax
            //   7e15                 | mov                 eax, dword ptr [esp + 0x58]
            //   8b442458             | movsx               eax, byte ptr [eax + 0xa]
            //   39442468             | cmp                 eax, 0x30
            //   7d0b                 | jl                  0x1338
            //   8b442468             | dec                 eax

        $sequence_7 = { e9???????? 488b9424b0000000 488b8c24a0000000 e8???????? 85c0 741a 488b9424b8000000 }
            // n = 7, score = 200
            //   e9????????           |                     
            //   488b9424b0000000     | mov                 ecx, dword ptr [eax]
            //   488b8c24a0000000     | dec                 eax
            //   e8????????           |                     
            //   85c0                 | mov                 dword ptr [esp + 0x38], eax
            //   741a                 | dec                 eax
            //   488b9424b8000000     | cmp                 dword ptr [esp + 0x38], 0

        $sequence_8 = { f3a4 488d442430 488b7c2420 488bf0 b930000000 f3a4 b801000000 }
            // n = 7, score = 200
            //   f3a4                 | mov                 eax, dword ptr [eax + 0x6c]
            //   488d442430           | dec                 eax
            //   488b7c2420           | mov                 eax, dword ptr [esp + 0x50]
            //   488bf0               | dec                 eax
            //   b930000000           | mov                 eax, dword ptr [esp + 0x50]
            //   f3a4                 | mov                 eax, dword ptr [eax + 0x68]
            //   b801000000           | add                 eax, dword ptr [esp + 0x60]

        $sequence_9 = { c744242084000000 4c8d0d76c31600 41b89e000000 ba75000000 b92e000000 e8???????? eb0b }
            // n = 7, score = 200
            //   c744242084000000     | dec                 eax
            //   4c8d0d76c31600       | mov                 dword ptr [esp + 0x68], eax
            //   41b89e000000         | mov                 dword ptr [esp + 0x20], 0x76bcdc67
            //   ba75000000           | inc                 ecx
            //   b92e000000           | mov                 ecx, 0x25
            //   e8????????           |                     
            //   eb0b                 | dec                 esp

    condition:
        7 of them and filesize < 6703104
}