rule RAN_Revil_Dec_2021_1 
{
   meta:
        description = "Detect Revil ransomware"
        author = "Arkbird_SOLG"
        reference = "Internal Research"
        date = "2021-12-23"
        hash1 = "30a91bd706362993f4af6cf951f856c120474693370163e36909625b8f4ea9e4"
        hash2 = "aaf25bbcd1ccee5e7cf1cd998e47e1a62d63a26755e02dcacf07f0ba38bb47ac"
        hash3 = "eb19ca4400ce63e91e8698b22924dff0376e75851b2ff6a00d08626835ba90fa"
        tlp = "Clear"
        adversary = "Sodinokibi"
   strings:
        $s1 = { 83 ec 10 8b 4d 10 53 56 be 00 ff 00 ff bb ff 00 ff 00 8b 01 8b d0 c1 c0 08 23 c3 c1 ca 08 23 d6 0b d0 8b 41 04 57 8b 7d 08 33 17 89 55 08 8b d0 c1 c0 08 23 c3 c1 ca 08 23 d6 0b d0 8b 41 08 33 57 04 8b d8 c1 c0 08 25 ff 00 ff 00 c1 cb 08 89 55 f8 23 de 0b d8 8b 41 0c 33 5f 08 8b d0 c1 c0 08 25 ff 00 ff 00 c1 ca 08 23 d6 0b d0 8b c3 c1 e8 08 0f b6 c8 8b 45 f8 33 57 0c c1 e8 10 8b 0c 8d ?? ?? ?? 00 0f b6 c0 33 0c 85 ?? ?? ?? 00 8b 45 08 c1 e8 18 33 0c 85 ?? ?? ?? 00 0f b6 c2 33 0c 85 ?? ?? ?? 00 8b c2 33 4f 10 c1 e8 08 89 4d f4 0f b6 c8 8b c3 c1 e8 10 0f b6 c0 8b 0c 8d ?? ?? ?? 00 33 0c 85 ?? ?? ?? 00 8b 45 f8 c1 e8 18 33 0c 85 ?? ?? ?? 00 8b 45 08 0f b6 c0 33 0c 85 ?? ?? ?? 00 8b c2 33 4f 14 c1 e8 10 89 4d fc 0f b6 c8 8b 45 08 c1 e8 08 0f b6 c0 8b 0c 8d ?? ?? ?? 00 33 0c 85 ?? ?? ?? 00 8b c3 c1 e8 18 c1 ea 18 33 0c 85 ?? ?? ?? 00 89 4d 10 8b 4d f8 8b 75 10 0f b6 c1 c1 e9 08 0f b6 c9 33 34 85 ?? ?? ?? 00 8b c6 89 75 10 33 47 18 8b 0c 8d ?? ?? ?? 00 89 45 10 8b 45 08 c1 e8 10 0f b6 c0 33 0c 85 ?? ?? ?? 00 33 0c 95 ?? ?? ?? 00 0f b6 c3 33 0c 85 ?? ?? ?? 00 8b 45 0c 33 4f 1c 83 c7 20 d1 f8 83 e8 01 89 45 0c e9 ee 01 00 00 8b 75 10 8b c6 c1 e8 08 0f b6 c8 8b 45 fc c1 e8 10 0f b6 c0 8b 0c 8d ?? ?? ?? 00 8b 55 f4 33 0c 85 ?? ?? ?? 00 8b c2 c1 e8 18 33 0c 85 ?? ?? ?? 00 8b 45 08 0f b6 c0 33 0c 85 ?? ?? ?? 00 33 0f 8b 45 08 c1 e8 08 89 4d f8 0f b6 c8 8b c6 c1 e8 10 0f b6 c0 8b 0c 8d ?? ?? ?? 00 33 0c 85 ?? ?? ?? 00 8b 45 fc c1 e8 18 33 0c 85 ?? ?? ?? 00 0f b6 c2 33 0c 85 ?? ?? ?? 00 33 4f 04 8b 45 08 c1 e8 10 89 4d f0 0f b6 c8 8b c2 c1 e8 08 0f b6 c0 }
        $s2 = { 81 ec 90 01 00 00 8d 85 10 ff ff ff 56 57 ff 75 0c 50 e8 09 14 00 00 8d 85 10 ff ff ff 50 8d 85 60 ff ff ff 50 e8 f6 13 00 00 8d 85 60 ff ff ff 50 8d 45 b0 50 e8 e6 13 00 00 ff 75 0c 8d 45 b0 50 8d 85 c0 fe ff ff 50 e8 f5 0b 00 00 8d 85 10 ff ff ff 50 8d 85 c0 fe ff ff 50 8d 85 70 fe ff ff 50 e8 db 0b 00 00 8d 85 70 fe ff ff 50 8d 45 b0 50 e8 a9 13 00 00 8d 85 c0 fe ff ff 50 8d 45 b0 50 8d 85 10 ff ff ff 50 e8 b4 0b 00 00 83 c4 44 8d 85 10 ff ff ff 50 8d 45 b0 50 e8 7f 13 00 00 8d 45 b0 50 8d 85 60 ff ff ff 50 e8 6f 13 00 00 8d 85 60 ff ff ff 50 8d 45 b0 50 e8 5f 13 00 00 8d 45 b0 50 8d 85 60 ff ff ff 50 e8 4f 13 00 00 8d 85 60 ff ff ff 50 8d 45 b0 50 e8 3f 13 00 00 8d 85 10 ff ff ff 50 8d 45 b0 50 8d 85 c0 fe ff ff 50 e8 4a 0b 00 00 8d 85 c0 fe ff ff 50 8d 45 b0 50 e8 18 13 00 00 8d 45 b0 50 8d 85 60 ff ff ff 50 e8 08 13 00 00 83 c4 44 6a 04 5f 8b f7 8d 85 60 ff ff ff 50 8d 45 b0 50 e8 f0 12 00 00 8d 45 b0 50 8d 85 60 ff ff ff 50 e8 e0 12 00 00 83 c4 10 83 ee 01 75 d8 8d 85 c0 fe ff ff 50 8d 85 60 ff ff ff 50 8d 85 10 ff ff ff 50 e8 e0 0a 00 00 8d 85 10 ff ff ff 50 8d 45 b0 50 e8 ae 12 00 00 8d 45 b0 50 8d 85 60 ff ff ff 50 e8 9e 12 00 00 83 c4 1c 6a 09 5e 8d 85 60 ff ff ff 50 8d 45 b0 50 e8 88 12 00 00 8d 45 b0 }
        $s3 = { 81 ec c8 01 00 00 56 8b 75 18 57 6a 14 59 ff 75 1c 8d bd 80 fe ff ff ff 75 18 f3 a5 e8 70 0d 00 00 8d 85 80 fe ff ff 50 ff 75 1c e8 cc fc ff ff 8b 75 20 8d bd 80 fe ff ff 6a 14 59 ff 75 24 f3 a5 ff 75 20 e8 48 0d 00 00 8d 85 80 fe ff ff 50 ff 75 24 e8 a4 fc ff ff ff 75 1c 8d 85 d0 fe ff ff ff 75 20 50 e8 25 02 00 00 ff 75 24 8d 85 68 ff ff ff ff 75 18 50 e8 13 02 00 00 8d 85 d0 fe ff ff 50 e8 e9 07 00 00 8d 85 d0 fe ff ff 50 e8 c9 06 00 00 83 c4 40 8d 85 68 ff ff ff 50 e8 ce 07 00 00 8d 85 68 ff ff ff 50 e8 ae 06 00 00 6a 14 59 8d 85 68 ff ff ff 50 8d 85 d0 fe ff ff 8d b5 d0 fe ff ff 8d bd 80 fe ff ff f3 a5 50 e8 be 0c 00 00 8d 85 80 fe ff ff 50 8d 85 68 ff ff ff 50 e8 16 fc ff ff 8d 85 d0 fe ff ff 50 8d 85 38 fe ff ff 50 e8 28 09 00 00 8d 85 68 ff ff ff 50 8d 85 d0 fe ff ff 50 e8 15 09 00 00 ff 75 28 8d 85 d0 fe ff ff 50 8d 85 68 ff ff ff 50 e8 6d 01 00 00 8d 85 68 ff ff ff 50 e8 43 07 00 00 8d 85 68 ff ff ff 50 e8 23 06 00 00 8b 7d 10 8d b5 38 fe ff ff 6a 14 59 f3 a5 8b 7d 14 8d 85 38 fe ff ff 6a 14 59 ff 75 18 8d b5 68 ff ff ff f3 a5 50 e8 bc 08 00 00 83 c4 44 8d 85 68 ff ff ff ff 75 1c 50 e8 aa 08 00 00 8d 85 68 ff ff ff 50 8d 85 38 fe ff ff 50 ff 75 08 e8 02 01 00 00 ff 75 08 e8 dc 06 00 00 ff 75 08 e8 c0 05 00 00 8d 85 38 fe ff ff 50 8d 85 68 ff ff ff 50 e8 4c fb ff ff 6a 48 8d 85 20 ff ff ff 6a 00 50 e8 ?? ?? ff ff 83 c4 30 33 f6 6a 00 68 41 db 01 00 ff b4 35 6c ff ff ff ff b4 35 68 ff ff ff e8 ?? ?? 00 00 89 84 35 d0 fe ff ff 89 94 35 d4 fe ff ff 83 c6 08 }
        $s4 = { 8b 75 08 8d 7d 9c dd 05 ?? ?? ?? 00 03 c3 89 45 e4 83 c8 ff 6a 06 59 f3 a5 89 45 94 83 e8 08 83 6d 94 08 89 45 98 33 c0 40 89 45 b4 83 65 ec 00 33 ff 21 7d e8 33 f6 6a 08 5a 89 7d 10 89 75 f4 89 75 f0 89 55 f8 c7 45 bc 01 00 00 00 89 5d b8 3b 5d e4 75 04 32 c9 eb 02 8a 0b 88 4d 0f f6 c2 20 0f 84 39 03 00 00 84 c9 0f 84 4f 0b 00 00 3b 7d 94 0f 87 46 0b 00 00 f6 c2 10 0f 84 d6 02 00 00 83 e2 ef 0f be c1 89 55 f8 dd d8 83 e8}
    condition:
        uint16(0) == 0x5A4D and filesize > 30KB and all of ($s*) 
}

