rule win_redalpha_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.redalpha."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.redalpha"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { c0e304 0fb6c3 50 68???????? }
            // n = 4, score = 400
            //   c0e304               | shl                 bl, 4
            //   0fb6c3               | movzx               eax, bl
            //   50                   | push                eax
            //   68????????           |                     

        $sequence_1 = { 50 e8???????? 83c40c c0e304 0fb6c3 }
            // n = 5, score = 400
            //   50                   | push                eax
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   c0e304               | shl                 bl, 4
            //   0fb6c3               | movzx               eax, bl

        $sequence_2 = { 8b4004 c74408e840d24300 8b41e8 8b5004 }
            // n = 4, score = 300
            //   8b4004               | push                eax
            //   c74408e840d24300     | add                 esp, 0xc
            //   8b41e8               | shl                 bl, 4
            //   8b5004               | push                eax

        $sequence_3 = { 8b3e 8bce e8???????? 8b4df8 }
            // n = 4, score = 300
            //   8b3e                 | ror                 eax, 0xf
            //   8bce                 | inc                 esp
            //   e8????????           |                     
            //   8b4df8               | add                 eax, edx

        $sequence_4 = { 8b3e 8bcb d3e8 83e001 895d08 }
            // n = 5, score = 300
            //   8b3e                 | inc                 ecx
            //   8bcb                 | and                 eax, edx
            //   d3e8                 | or                  ecx, eax
            //   83e001               | inc                 esp
            //   895d08               | add                 eax, eax

        $sequence_5 = { 44035c240c 4503d8 41c1c30e 4503d9 }
            // n = 4, score = 300
            //   44035c240c           | add                 eax, eax
            //   4503d8               | ror                 eax, 0xb
            //   41c1c30e             | inc                 ecx
            //   4503d9               | add                 eax, dword ptr [ecx + 4]

        $sequence_6 = { 4403542420 4503d3 41c1c207 4503d1 }
            // n = 4, score = 300
            //   4403542420           | add                 eax, ebx
            //   4503d3               | inc                 ecx
            //   41c1c207             | mov                 eax, eax
            //   4503d1               | inc                 ecx

        $sequence_7 = { 8b4004 c74410e840d24300 8b06 8b4804 }
            // n = 4, score = 300
            //   8b4004               | shl                 bl, 4
            //   c74410e840d24300     | movzx               eax, bl
            //   8b06                 | push                eax
            //   8b4804               | push                eax

        $sequence_8 = { 4403442424 4103c0 c1c80b 41034104 }
            // n = 4, score = 300
            //   4403442424           | add                 eax, ebx
            //   4103c0               | inc                 ecx
            //   c1c80b               | rol                 eax, 9
            //   41034104             | inc                 ebp

        $sequence_9 = { 4403c1 41c1c80f 4403c2 418bc8 f7d1 4123cb 448b74241c }
            // n = 7, score = 300
            //   4403c1               | add                 eax, ecx
            //   41c1c80f             | inc                 ecx
            //   4403c2               | add                 dword ptr [ecx + 0xc], edx
            //   418bc8               | inc                 ecx
            //   f7d1                 | mov                 dword ptr [ecx + 4], eax
            //   4123cb               | inc                 esp
            //   448b74241c           | add                 edx, dword ptr [esp + 0x20]

        $sequence_10 = { 4889742410 57 4883ec20 488bd9 458bd9 8b8914170000 }
            // n = 6, score = 300
            //   4889742410           | dec                 eax
            //   57                   | mov                 dword ptr [esp + 0x10], esi
            //   4883ec20             | push                edi
            //   488bd9               | dec                 eax
            //   458bd9               | sub                 esp, 0x20
            //   8b8914170000         | dec                 eax

        $sequence_11 = { 4403442418 4403c3 41c1c009 4503c3 }
            // n = 4, score = 300
            //   4403442418           | inc                 ecx
            //   4403c3               | rol                 eax, 6
            //   41c1c009             | inc                 esp
            //   4503c3               | add                 eax, ebx

        $sequence_12 = { 4403c0 41c1c010 4503c3 4133c8 8bc1 4133c2 03442418 }
            // n = 7, score = 300
            //   4403c0               | inc                 esp
            //   41c1c010             | add                 eax, dword ptr [esp + 0x24]
            //   4503c3               | inc                 ecx
            //   4133c8               | add                 eax, eax
            //   8bc1                 | ror                 eax, 0xb
            //   4133c2               | inc                 ecx
            //   03442418             | add                 eax, dword ptr [ecx + 4]

        $sequence_13 = { 8b3f ff750c 53 6aff }
            // n = 4, score = 300
            //   8b3f                 | inc                 ecx
            //   ff750c               | xor                 eax, edx
            //   53                   | xor                 eax, edx
            //   6aff                 | add                 eax, 0x6d9d6122

        $sequence_14 = { 8b3e 897df4 0fb607 0fb64f01 334c8660 }
            // n = 5, score = 300
            //   8b3e                 | inc                 ecx
            //   897df4               | rol                 ebx, 0xe
            //   0fb607               | inc                 ebp
            //   0fb64f01             | add                 ebx, ecx
            //   334c8660             | inc                 ecx

        $sequence_15 = { 4403442410 4503c2 41c1c006 4403c3 410bd0 }
            // n = 5, score = 300
            //   4403442410           | mov                 ebx, ecx
            //   4503c2               | inc                 ebp
            //   41c1c006             | mov                 ebx, ecx
            //   4403c3               | mov                 ecx, dword ptr [ecx + 0x1714]
            //   410bd0               | inc                 esp

        $sequence_16 = { 8945f8 8d45f0 64a300000000 f2c3 8b4de4 33cd f2e8e4fffeff }
            // n = 7, score = 100
            //   8945f8               | mov                 dword ptr [ebp - 8], eax
            //   8d45f0               | lea                 eax, [ebp - 0x10]
            //   64a300000000         | mov                 dword ptr fs:[0], eax
            //   f2c3                 | bnd ret             
            //   8b4de4               | mov                 ecx, dword ptr [ebp - 0x1c]
            //   33cd                 | xor                 ecx, ebp
            //   f2e8e4fffeff         | bnd call            0xfffeffea

        $sequence_17 = { 0f85a4010000 6a25 68???????? 8d4dd8 897de8 c745ec07000000 668945d8 }
            // n = 7, score = 100
            //   0f85a4010000         | jne                 0x1aa
            //   6a25                 | push                0x25
            //   68????????           |                     
            //   8d4dd8               | lea                 ecx, [ebp - 0x28]
            //   897de8               | mov                 dword ptr [ebp - 0x18], edi
            //   c745ec07000000       | mov                 dword ptr [ebp - 0x14], 7
            //   668945d8             | mov                 word ptr [ebp - 0x28], ax

        $sequence_18 = { ffd3 8d7e10 c7450c04000000 57 ff15???????? 8b460c 8945dc }
            // n = 7, score = 100
            //   ffd3                 | call                ebx
            //   8d7e10               | lea                 edi, [esi + 0x10]
            //   c7450c04000000       | mov                 dword ptr [ebp + 0xc], 4
            //   57                   | push                edi
            //   ff15????????         |                     
            //   8b460c               | mov                 eax, dword ptr [esi + 0xc]
            //   8945dc               | mov                 dword ptr [ebp - 0x24], eax

        $sequence_19 = { 8d85f4fbffff 50 ff55fc 53 8d85f4fdffff 50 ffd6 }
            // n = 7, score = 100
            //   8d85f4fbffff         | lea                 eax, [ebp - 0x40c]
            //   50                   | push                eax
            //   ff55fc               | call                dword ptr [ebp - 4]
            //   53                   | push                ebx
            //   8d85f4fdffff         | lea                 eax, [ebp - 0x20c]
            //   50                   | push                eax
            //   ffd6                 | call                esi

        $sequence_20 = { ffd6 68???????? 8d85f8fdffff 50 ffd7 8d85f8fdffff 50 }
            // n = 7, score = 100
            //   ffd6                 | call                esi
            //   68????????           |                     
            //   8d85f8fdffff         | lea                 eax, [ebp - 0x208]
            //   50                   | push                eax
            //   ffd7                 | call                edi
            //   8d85f8fdffff         | lea                 eax, [ebp - 0x208]
            //   50                   | push                eax

        $sequence_21 = { 51 6a02 6a00 68???????? ff75a4 ff15???????? 8d4da8 }
            // n = 7, score = 100
            //   51                   | push                ecx
            //   6a02                 | push                2
            //   6a00                 | push                0
            //   68????????           |                     
            //   ff75a4               | push                dword ptr [ebp - 0x5c]
            //   ff15????????         |                     
            //   8d4da8               | lea                 ecx, [ebp - 0x58]

        $sequence_22 = { 8bf0 6a00 56 e8???????? ff750c }
            // n = 5, score = 100
            //   8bf0                 | mov                 esi, eax
            //   6a00                 | push                0
            //   56                   | push                esi
            //   e8????????           |                     
            //   ff750c               | push                dword ptr [ebp + 0xc]

        $sequence_23 = { 742b 8d8df4fdffff 51 50 }
            // n = 4, score = 100
            //   742b                 | je                  0x2d
            //   8d8df4fdffff         | lea                 ecx, [ebp - 0x20c]
            //   51                   | push                ecx
            //   50                   | push                eax

        $sequence_24 = { 8d44246c 8bf1 57 50 33db }
            // n = 5, score = 100
            //   8d44246c             | lea                 eax, [esp + 0x6c]
            //   8bf1                 | mov                 esi, ecx
            //   57                   | push                edi
            //   50                   | push                eax
            //   33db                 | xor                 ebx, ebx

        $sequence_25 = { ffd3 57 ffd3 5b 5e 8b4dfc }
            // n = 6, score = 100
            //   ffd3                 | call                ebx
            //   57                   | push                edi
            //   ffd3                 | call                ebx
            //   5b                   | pop                 ebx
            //   5e                   | pop                 esi
            //   8b4dfc               | mov                 ecx, dword ptr [ebp - 4]

        $sequence_26 = { 8d0441 53 8d1c3f 53 50 51 e8???????? }
            // n = 7, score = 100
            //   8d0441               | lea                 eax, [ecx + eax*2]
            //   53                   | push                ebx
            //   8d1c3f               | lea                 ebx, [edi + edi]
            //   53                   | push                ebx
            //   50                   | push                eax
            //   51                   | push                ecx
            //   e8????????           |                     

        $sequence_27 = { 8b04bd30744100 807c302900 7504 32c0 eb1a }
            // n = 5, score = 100
            //   8b04bd30744100       | mov                 eax, dword ptr [edi*4 + 0x417430]
            //   807c302900           | cmp                 byte ptr [eax + esi + 0x29], 0
            //   7504                 | jne                 6
            //   32c0                 | xor                 al, al
            //   eb1a                 | jmp                 0x1c

        $sequence_28 = { 8b0d???????? 83fe0f 7cdf 83fe0f }
            // n = 4, score = 100
            //   8b0d????????         |                     
            //   83fe0f               | cmp                 esi, 0xf
            //   7cdf                 | jl                  0xffffffe1
            //   83fe0f               | cmp                 esi, 0xf

        $sequence_29 = { 8b04cd8c1f4100 5f 5e 5b 8be5 5d c3 }
            // n = 7, score = 100
            //   8b04cd8c1f4100       | mov                 eax, dword ptr [ecx*8 + 0x411f8c]
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi
            //   5b                   | pop                 ebx
            //   8be5                 | mov                 esp, ebp
            //   5d                   | pop                 ebp
            //   c3                   | ret                 

    condition:
        7 of them and filesize < 606208
}