rule RAN_Babuk_Loader_Dec_2021_1
{
    meta:
        description = "Detect the loader used by babuk ransomware"
        author = "Arkbird_SOLG"
        date = "2021-12-18"
        reference = "Internal Research"
        hash1 = "2bf730fe355eb8301a064b1fb368abff003e59357ee8e68b473767b41f7e9bc5"
        hash2 = "341061776f03453e20f9e7eb3d91ff7b7842ec1322aab5d0dae4fba7c3d89eef"
	hash3 = "32f8bb15e0cf8c8988ec4dfe9486291eabf401bfb919598ab850199cc4afea75"
	hash4 = "752d66990097c8be7760d8d6011b1e91daa1d5518951d86f9fdf3d126d54872a"
	hash5 = "c66fe63717fbcc4a6fe553335a23b673501ee26c02600787af0874d02f3fb23f"
        tlp = "Clear"
        adversary = "Babuk"
    strings:
        $s1 = { 00 72 01 00 00 70 0a 17 8d 04 00 00 02 0b 28 06 00 00 0a 0c 00 72 [2] 00 70 08 6f 07 00 00 0a 28 08 00 00 0a 28 09 00 00 0a 00 14 72 [2] 00 70 07 16 8f 04 00 00 02 7c 03 00 00 04 28 0c 00 00 06 26 12 03 fe 15 03 00 00 02 12 03 17 7d 01 00 00 04 12 03 07 7d 02 00 00 04 07 16 8f 04 00 00 02 18 7d 04 00 00 04 08 6f 0a 00 00 0a 16 12 03 09 8c 03 00 00 02 28 0b 00 00 0a 7e 0c 00 00 0a 7e 0c 00 00 0a 28 0a 00 00 06 2c 0a 28 0d 00 00 0a 16 fe 01 2b 01 16 13 10 11 10 2d 11 00 72 [2] 00 70 28 09 00 00 0a 00 dd e9 02 00 00 00 de 12 08 14 fe 01 13 10 11 10 2d 07 08 6f 0e 00 00 0a 00 dc 00 28 0f 00 00 0a 13 11 12 11 72 [2] 00 70 28 10 00 00 0a 13 04 72 [2] 00 70 11 04 72 [2] 00 70 28 11 00 00 0a 13 05 11 05 19 16 1f 0a 20 00 08 00 00 20 00 08 00 00 16 7e 0c 00 00 0a 28 06 00 00 06 13 06 11 06 15 73 12 00 00 0a 28 13 00 00 0a 16 fe 01 13 10 11 10 2d 25 00 72 [2] 00 70 28 0d 00 00 0a 73 14 00 00 0a 6f 15 00 00 0a 28 08 00 00 0a 28 09 00 00 0a 00 38 53 02 00 00 16 73 16 00 00 0a 13 07 14 fe 06 04 00 00 06 73 17 00 00 0a 73 18 00 00 0a 13 08 11 08 17 6f 19 00 00 0a 00 11 08 18 8d 01 00 00 01 13 12 11 12 16 11 06 8c 14 00 00 01 a2 11 12 17 11 07 a2 11 12 6f 1a 00 00 0a 00 14 fe 06 03 00 00 06 73 17 00 00 0a 73 18 00 00 0a 13 09 11 09 17 6f 19 00 00 0a 00 11 09 11 04 6f 1a 00 00 0a 00 11 07 20 e8 03 00 00 6f 1b 00 00 0a 16 fe 01 13 10 11 10 3a 9b 01 00 00 00 11 06 28 08 00 00 06 16 fe 01 13 10 11 10 3a 84 01 00 00 00 28 06 00 00 0a 6f 0a 00 00 0a 13 0a 72 [2] 00 70 11 0a 8c 14 00 00 01 28 1c 00 00 0a 28 09 00 00 0a 00 12 0b fe 15 08 00 00 02 12 0b 11 0b 8c 08 00 00 02 28 0b 00 00 0a 7d 1d 00 00 04 12 0b 7e 0c 00 00 0a 7d 1e 00 00 04 12 0b 17 7d 1f 00 00 04 12 0c 12 0d 12 0b 20 00 04 00 00 28 0b 00 00 06 26 12 0e fe 15 06 00 00 02 12 0f fe 15 07 00 00 02 12 0f 11 0f 8c 07 00 00 02 28 0b 00 00 0a 7d 0b 00 00 04 12 0f 11 0d 7d 1c 00 00 04 12 0f 11 0d 7d 1b 00 00 04 12 0f 72 [2] 00 70 7d 0d 00 00 04 12 0f 20 01 01 00 00 7d 16 00 00 04 12 0f 16 7d 17 00 00 04 11 0a 14 06 7e 0c 00 00 0a 7e 0c 00 00 0a 17 20 00 00 00 08 7e 0c 00 00 0a 7e 0c 00 00 0a 12 0f 12 0e 28 0d 00 00 06 16 fe 01 13 10 11 10 3a 97 00 00 00 00 72 [2] 00 70 12 0e 7b 09 00 00 04 8c 1b 00 00 01 28 1d 00 00 0a 00 14 fe 06 02 00 00 06 73 17 00 00 0a 73 18 00 00 0a 13 08 11 08 17 6f 19 00 00 0a 00 11 08 11 0c 8c 14 00 00 01 6f 1a 00 00 0a 00 12 0e 7b 07 00 00 04 16 73 1e 00 00 0a 73 0f 00 00 06 15 6f 1b 00 00 0a 26 11 08 6f 1f 00 00 0a 00 12 0e 7b 07 00 00 04 28 09 00 00 06 26 12 0e 7b 08 00 00 04 28 09 00 00 06 26 11 0a 28 09 00 00 06 26 11 0d 28 09 00 00 06 26 11 0c 28 09 00 00 06 26 00 00 00 2b 2b 00 72 [2] 00 70 28 09 00 00 0a 00 11 05 20 00 00 00 40 16 7e 0c 00 00 0a 19 20 80 00 00 00 7e 0c 00 00 0a 28 05 00 00 06 26 00 11 06 28 09 00 00 06 26 00 2a }
        $s2 = { 02 14 fe 06 1b 00 00 06 73 22 00 00 06 7d 2d 00 00 04 02 14 fe 06 1c 00 00 06 73 26 00 00 06 7d 2e 00 00 04 02 20 88 13 00 00 7d 2f 00 00 04 02 28 28 00 00 0a 00 00 02 72 [2] 00 70 73 2c 00 00 0a 7d 24 00 00 04 28 2d 00 00 0a 1e fe 01 16 fe 01 0a 06 2d 22 00 02 02 7b 24 00 00 04 7e 21 00 00 04 7e 23 00 00 04 72 [2] 00 70 17 16 28 19 00 00 06 00 00 2b 20 00 02 02 7b 24 00 00 04 7e 20 00 00 04 7e 22 00 00 04 72 [2] 00 70 17 16 28 19 00 00 06 00 00 00 2a }
        $s3 = { 00 02 75 11 00 00 01 0a 73 16 00 00 06 0b 7e 0c 00 00 0a 0c 00 07 12 02 1c 8d 11 00 00 01 13 04 11 04 16 72 [2] 00 70 a2 11 04 17 06 a2 11 04 18 72 [2] 00 70 a2 11 04 19 06 a2 11 04 1a 72 [2] 00 70 a2 11 04 1b 06 a2 11 04 28 24 00 00 0a 16 6f 18 00 00 06 26 00 de 0c 0d 00 09 28 25 00 00 0a 00 00 de 00 00 2a }
        $s4 = { 00 03 28 3a 00 00 0a 0a 7e 0c 00 00 0a 0b 7e 0c 00 00 0a 0c 02 7c 24 00 00 04 fe 16 06 00 00 01 6f 3b 00 00 0a 72 [2] 00 70 06 02 7b 2c 00 00 04 14 12 01 28 13 00 00 06 0d 09 16 fe 01 13 05 11 05 2d 29 00 72 [2] 00 70 12 03 72 [2] 00 70 28 3c 00 00 0a 28 08 00 00 0a 28 09 00 00 0a 00 7e 0c 00 00 0a 13 04 38 a9 00 00 00 07 28 3a 00 00 0a 12 02 28 10 00 00 06 0d 12 01 28 12 00 00 06 26 09 16 fe 01 13 05 11 05 2d 26 00 72 [2] 00 70 12 03 72 [2] 00 70 28 3c 00 00 0a 28 08 00 00 0a 28 09 00 00 0a 00 7e 0c 00 00 0a 13 04 2b 63 08 1f 0c 02 7b 2f 00 00 04 6e 73 3d 00 00 0a 28 14 00 00 06 0d 09 16 fe 01 13 05 11 05 2d 1e 00 72 [2] 00 70 12 03 72 [2] 00 70 28 3c 00 00 0a 28 08 00 00 0a 28 09 00 00 0a 00 00 72 [2] 00 70 12 02 72 [2] 00 70 28 3e 00 00 0a 72 [2] 00 70 28 11 00 00 0a 28 09 00 00 0a 00 08 13 04 2b 00 11 04 2a }
    condition:
       uint16(0) == 0x5A4D and filesize > 10KB and all of ($s*) 
}
