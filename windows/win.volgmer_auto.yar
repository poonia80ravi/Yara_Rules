rule win_volgmer_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.volgmer."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.volgmer"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 48895c2410 48897c2418 55 488d6c24b0 4881ec50010000 488b05???????? }
            // n = 6, score = 300
            //   48895c2410           | mov                 edx, esi
            //   48897c2418           | inc                 ecx
            //   55                   | cmp                 ebp, 1
            //   488d6c24b0           | jne                 0x13
            //   4881ec50010000       | dec                 ecx
            //   488b05????????       |                     

        $sequence_1 = { 4833cc e8???????? 4c8d9c2450010000 498b5b18 498b7b20 498be3 }
            // n = 6, score = 300
            //   4833cc               | pop                 ebp
            //   e8????????           |                     
            //   4c8d9c2450010000     | inc                 ecx
            //   498b5b18             | cmp                 ebp, 1
            //   498b7b20             | jne                 0x13
            //   498be3               | dec                 ecx

        $sequence_2 = { e8???????? e8???????? e8???????? c705????????04000000 }
            // n = 4, score = 200
            //   e8????????           |                     
            //   e8????????           |                     
            //   e8????????           |                     
            //   c705????????04000000     |     

        $sequence_3 = { 8bd7 c6843c4002000000 488d8c2440020000 e8???????? 488d942440020000 498bce ff15???????? }
            // n = 7, score = 200
            //   8bd7                 | push                ebp
            //   c6843c4002000000     | dec                 eax
            //   488d8c2440020000     | lea                 ebp, [esp - 0x50]
            //   e8????????           |                     
            //   488d942440020000     | dec                 eax
            //   498bce               | sub                 esp, 0x150
            //   ff15????????         |                     

        $sequence_4 = { e8???????? 488bd8 eb03 488bdf 488d056efeffff }
            // n = 5, score = 200
            //   e8????????           |                     
            //   488bd8               | dec                 eax
            //   eb03                 | mov                 ebx, eax
            //   488bdf               | jmp                 5
            //   488d056efeffff       | dec                 eax

        $sequence_5 = { e9???????? 4183fd01 750d 498bd6 }
            // n = 4, score = 200
            //   e9????????           |                     
            //   4183fd01             | mov                 dword ptr [esp + 0x38], ebx
            //   750d                 | dec                 esp
            //   498bd6               | mov                 dword ptr [esp + 0x30], ebx

        $sequence_6 = { c6843d6003000000 488d8d60030000 e8???????? 488d9560030000 498bcd ff15???????? 0fb63d???????? }
            // n = 7, score = 200
            //   c6843d6003000000     | dec                 eax
            //   488d8d60030000       | mov                 dword ptr [esp + 0x10], ebx
            //   e8????????           |                     
            //   488d9560030000       | dec                 eax
            //   498bcd               | mov                 dword ptr [esp + 0x18], edi
            //   ff15????????         |                     
            //   0fb63d????????       |                     

        $sequence_7 = { e8???????? 4533db 488d442440 4c895c2438 4c895c2430 4183c9ff 4c8bc5 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   4533db               | dec                 eax
            //   488d442440           | test                eax, eax
            //   4c895c2438           | je                  9
            //   4c895c2430           | mov                 word ptr [eax + 2], di
            //   4183c9ff             | inc                 ebp
            //   4c8bc5               | xor                 ebx, ebx

        $sequence_8 = { 448bc7 48894590 488d8d80090000 e8???????? 8bd7 c6843d8009000000 488d8d80090000 }
            // n = 7, score = 200
            //   448bc7               | mov                 eax, dword ptr [ebp + 8]
            //   48894590             | mov                 ecx, edi
            //   488d8d80090000       | mov                 esi, dword ptr [ebp + 0x10]
            //   e8????????           |                     
            //   8bd7                 | mov                 dword ptr [ebp - 0x24], 1
            //   c6843d8009000000     | cmp                 al, 0x7a
            //   488d8d80090000       | cmp                 eax, 0x3d8a3d80

        $sequence_9 = { e8???????? 4885c0 7404 66897802 }
            // n = 4, score = 200
            //   e8????????           |                     
            //   4885c0               | mov                 ebx, edi
            //   7404                 | dec                 eax
            //   66897802             | lea                 eax, [0xfffffe6e]

        $sequence_10 = { e9???????? 488d4c2430 488bd3 e8???????? }
            // n = 4, score = 200
            //   e9????????           |                     
            //   488d4c2430           | dec                 eax
            //   488bd3               | add                 esp, 0x528
            //   e8????????           |                     

        $sequence_11 = { b900040000 663bc1 7f40 6685c0 7e1a 440fbfc0 488d95f6000000 }
            // n = 7, score = 200
            //   b900040000           | test                eax, eax
            //   663bc1               | je                  0x376e
            //   7f40                 | ret                 
            //   6685c0               | dec                 eax
            //   7e1a                 | mov                 dword ptr [esp + 0x10], ebx
            //   440fbfc0             | dec                 eax
            //   488d95f6000000       | mov                 dword ptr [esp + 0x18], edi

        $sequence_12 = { e9???????? 897c2448 8bf7 897c2440 6690 85f6 7537 }
            // n = 7, score = 200
            //   e9????????           |                     
            //   897c2448             | xchg                eax, esp
            //   8bf7                 | cmp                 eax, 0x3da33d9b
            //   897c2440             | lea                 eax, [ebp - 0x130]
            //   6690                 | push                0x100
            //   85f6                 | push                0
            //   7537                 | push                eax

        $sequence_13 = { e8???????? 4881c428050000 415e 415d }
            // n = 4, score = 200
            //   e8????????           |                     
            //   4881c428050000       | dec                 eax
            //   415e                 | lea                 eax, [esp + 0x40]
            //   415d                 | dec                 esp

        $sequence_14 = { eb04 8b742434 33d2 488d4c2450 41b89c000000 e8???????? 488d4c2450 }
            // n = 7, score = 200
            //   eb04                 | push                ebp
            //   8b742434             | dec                 eax
            //   33d2                 | lea                 ebp, [esp - 0x50]
            //   488d4c2450           | dec                 eax
            //   41b89c000000         | sub                 esp, 0x150
            //   e8????????           |                     
            //   488d4c2450           | dec                 eax

        $sequence_15 = { 50 e8???????? 6800080000 8d831c040000 6a00 }
            // n = 5, score = 100
            //   50                   | mov                 dword ptr [esp + 0x18], edi
            //   e8????????           |                     
            //   6800080000           | push                ebp
            //   8d831c040000         | dec                 eax
            //   6a00                 | lea                 ebp, [esp - 0x50]

        $sequence_16 = { 894de0 8b049d80f16e00 0fb6440828 83e001 }
            // n = 4, score = 100
            //   894de0               | cmp                 ax, cx
            //   8b049d80f16e00       | jg                  0x42
            //   0fb6440828           | test                ax, ax
            //   83e001               | jle                 0x21

        $sequence_17 = { 8b04cd44a97300 5f 5e 5b 8be5 5d }
            // n = 6, score = 100
            //   8b04cd44a97300       | dec                 eax
            //   5f                   | mov                 dword ptr [ebp + 0x40], eax
            //   5e                   | dec                 eax
            //   5b                   | mov                 dword ptr [esp + 0x10], ebx
            //   8be5                 | dec                 eax
            //   5d                   | mov                 dword ptr [esp + 0x18], edi

        $sequence_18 = { 8b742414 23de 8b742410 33da }
            // n = 4, score = 100
            //   8b742414             | mov                 esi, dword ptr [esp + 0x14]
            //   23de                 | and                 ebx, esi
            //   8b742410             | mov                 esi, dword ptr [esp + 0x10]
            //   33da                 | xor                 ebx, edx

        $sequence_19 = { 83b8a800000000 7512 8b04bd80f16e00 807c302900 }
            // n = 4, score = 100
            //   83b8a800000000       | dec                 eax
            //   7512                 | mov                 dword ptr [esp + 0x18], edi
            //   8b04bd80f16e00       | push                ebp
            //   807c302900           | dec                 eax

        $sequence_20 = { 8b4508 57 8d3c85c8f47300 8b0f }
            // n = 4, score = 100
            //   8b4508               | sub                 esp, 0x150
            //   57                   | dec                 eax
            //   8d3c85c8f47300       | mov                 ecx, dword ptr [ebp + 0x40]
            //   8b0f                 | dec                 eax

        $sequence_21 = { 8985e4f3ffff ffd6 6800080000 8985d8f3ffff }
            // n = 4, score = 100
            //   8985e4f3ffff         | push                ebp
            //   ffd6                 | dec                 eax
            //   6800080000           | lea                 ebp, [esp - 0x50]
            //   8985d8f3ffff         | dec                 eax

        $sequence_22 = { 0f840d010000 8d8318030000 50 8d85bcf7ffff 68???????? }
            // n = 5, score = 100
            //   0f840d010000         | dec                 eax
            //   8d8318030000         | sub                 esp, 0x150
            //   50                   | dec                 eax
            //   8d85bcf7ffff         | xor                 eax, esp
            //   68????????           |                     

        $sequence_23 = { 23df 33d8 8b442410 03de 03d8 8b442424 c1c71e }
            // n = 7, score = 100
            //   23df                 | and                 ebx, edi
            //   33d8                 | xor                 ebx, eax
            //   8b442410             | mov                 eax, dword ptr [esp + 0x10]
            //   03de                 | add                 ebx, esi
            //   03d8                 | add                 ebx, eax
            //   8b442424             | mov                 eax, dword ptr [esp + 0x24]
            //   c1c71e               | rol                 edi, 0x1e

        $sequence_24 = { 6bc830 8b049580f16e00 8b440818 83f8ff 7409 83f8fe 7404 }
            // n = 7, score = 100
            //   6bc830               | lea                 ecx, [ebp + 0x980]
            //   8b049580f16e00       | mov                 edx, edi
            //   8b440818             | mov                 byte ptr [ebp + edi + 0x980], 0
            //   83f8ff               | dec                 eax
            //   7409                 | lea                 ecx, [ebp + 0x980]
            //   83f8fe               | mov                 dword ptr [esp + 0x48], edi
            //   7404                 | mov                 esi, edi

        $sequence_25 = { 83e03f c1f906 53 6bd830 56 8b048d80f16e00 57 }
            // n = 7, score = 100
            //   83e03f               | lea                 ebp, [esp - 0x50]
            //   c1f906               | dec                 eax
            //   53                   | sub                 esp, 0x150
            //   6bd830               | dec                 eax
            //   56                   | xor                 eax, esp
            //   8b048d80f16e00       | dec                 eax
            //   57                   | mov                 dword ptr [ebp + 0x40], eax

        $sequence_26 = { 85db 746b 56 8d442408 57 }
            // n = 5, score = 100
            //   85db                 | test                ebx, ebx
            //   746b                 | je                  0x6d
            //   56                   | push                esi
            //   8d442408             | lea                 eax, [esp + 8]
            //   57                   | push                edi

        $sequence_27 = { 8b0c9580f16e00 8844192e 8b049580f16e00 804c182d04 ff4604 }
            // n = 5, score = 100
            //   8b0c9580f16e00       | mov                 dword ptr [esp + 0x40], edi
            //   8844192e             | nop                 
            //   8b049580f16e00       | test                esi, esi
            //   804c182d04           | jne                 0x41
            //   ff4604               | mov                 ecx, 0x400

        $sequence_28 = { 53 56 8b048580f16e00 33db }
            // n = 4, score = 100
            //   53                   | inc                 esp
            //   56                   | movsx               eax, ax
            //   8b048580f16e00       | dec                 eax
            //   33db                 | lea                 edx, [ebp + 0xf6]

        $sequence_29 = { 6a00 8d54242c 66c7000000 6a64 }
            // n = 4, score = 100
            //   6a00                 | push                0
            //   8d54242c             | lea                 edx, [esp + 0x2c]
            //   66c7000000           | mov                 word ptr [eax], 0
            //   6a64                 | push                0x64

        $sequence_30 = { 660f2835???????? 660f54c1 660f56c3 660f58e0 660fc5c400 25f0070000 660f28a030bf6e00 }
            // n = 7, score = 100
            //   660f2835????????     |                     
            //   660f54c1             | dec                 ecx
            //   660f56c3             | mov                 ebx, dword ptr [ebx + 0x18]
            //   660f58e0             | dec                 ecx
            //   660fc5c400           | mov                 edi, dword ptr [ebx + 0x20]
            //   25f0070000           | dec                 ecx
            //   660f28a030bf6e00     | mov                 esp, ebx

        $sequence_31 = { 8d4c2440 51 e8???????? 8b542418 83c408 }
            // n = 5, score = 100
            //   8d4c2440             | lea                 ecx, [esp + 0x40]
            //   51                   | push                ecx
            //   e8????????           |                     
            //   8b542418             | mov                 edx, dword ptr [esp + 0x18]
            //   83c408               | add                 esp, 8

        $sequence_32 = { c745e0d8ba7300 8b4508 8bcf 8b7510 c745dc01000000 }
            // n = 5, score = 100
            //   c745e0d8ba7300       | xor                 ecx, esp
            //   8b4508               | dec                 esp
            //   8bcf                 | lea                 ebx, [esp + 0x150]
            //   8b7510               | dec                 ecx
            //   c745dc01000000       | mov                 ebx, dword ptr [ebx + 0x18]

        $sequence_33 = { 8b4c2404 6a00 6a00 8d442410 6a10 50 }
            // n = 6, score = 100
            //   8b4c2404             | mov                 ecx, dword ptr [esp + 4]
            //   6a00                 | push                0
            //   6a00                 | push                0
            //   8d442410             | lea                 eax, [esp + 0x10]
            //   6a10                 | push                0x10
            //   50                   | push                eax

        $sequence_34 = { 8bc8 83e03f c1f906 6bc030 03048d80f16e00 }
            // n = 5, score = 100
            //   8bc8                 | inc                 esp
            //   83e03f               | mov                 eax, edi
            //   c1f906               | dec                 eax
            //   6bc030               | mov                 dword ptr [ebp - 0x70], eax
            //   03048d80f16e00       | dec                 eax

        $sequence_35 = { 8d85d0feffff 6800010000 6a00 50 }
            // n = 4, score = 100
            //   8d85d0feffff         | dec                 eax
            //   6800010000           | mov                 dword ptr [esp + 0x18], edi
            //   6a00                 | push                ebp
            //   50                   | dec                 eax

        $sequence_36 = { 3c7a 3d803d8a3d 94 3d9b3da33d }
            // n = 4, score = 100
            //   3c7a                 | dec                 ecx
            //   3d803d8a3d           | mov                 edi, dword ptr [ebx + 0x20]
            //   94                   | dec                 ecx
            //   3d9b3da33d           | mov                 esp, ebx

    condition:
        7 of them and filesize < 393216
}