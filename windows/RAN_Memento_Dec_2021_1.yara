rule RAN_Memento_Dec_2021_1 {
   meta:
        description = "Detect Memento ransomware"
        author = "Arkbird_SOLG"
        reference = "Internal Research"
        date = "2021-12-22"
        hash1 = "09a0caadc4df3d4278368f94f52007894c2b51d3785d985cb8e42646e8a33b68"
        tlp = "Clear"
        adversary = "Memento"
        level = "Experimental"
   strings:
        $s1 = { 48 85 c9 74 c2 89 74 24 28 4c 8d 44 24 30 45 33 c9 48 89 74 24 20 33 d2 ff 15 6b 31 01 00 48 8b f8 48 83 f8 ff 75 47 ff 15 3c 2f 01 00 83 f8 02 72 0f 83 f8 03 76 27 83 f8 08 74 12 83 f8 12 74 1d e8 8f de ff ff c7 00 16 00 00 00 eb 89 e8 82 de ff ff c7 00 0c 00 00 00 e9 79 ff ff ff e8 72 de ff ff c7 00 02 00 00 00 e9 69 ff ff ff 8b 44 24 30 48 8d 4c 24 34 3d 80 00 00 00 0f 44 c6 89 03 e8 83 01 00 00 48 8d 4c 24 3c 48 89 43 08 e8 75 01 00 00 48 8d 4c 24 44 48 89 43 10 e8 67 01 00 00 48 89 43 18 48 8d 4b 24 8b 44 24 50 4c 8d 44 24 5c ba 04 01 00 00 89 43 20 e8 39 8d 00 00 85 c0 75 08 48 8b c7 e9 0f ff ff ff 45 33 c9 48 89 74 24 20 45 33 c0 33 d2 33 c9 e8 c9 35 }
        $s2 = { 48 83 65 d0 00 48 8d 4d b0 48 83 65 d8 00 33 d2 48 83 65 e0 00 48 83 65 e8 00 48 83 65 f0 00 c6 45 f8 00 e8 bf d4 ff ff 48 8b 45 b8 41 b8 e9 fd 00 00 44 39 40 0c 75 13 80 7d c8 00 74 42 48 8b 45 b0 83 a0 a8 03 00 00 fd eb 35 e8 77 8c 00 00 85 c0 75 18 38 45 c8 74 0b 48 8b 45 b0 83 a0 a8 03 00 00 fd 41 b8 01 00 00 00 eb 14 80 7d c8 00 74 0b 48 8b 45 b0 83 a0 a8 03 00 00 fd 45 33 c0 48 8d 55 d0 48 8b cf e8 f7 f6 ff ff 85 c0 74 14 80 7d f8 00 74 09 48 8b 4d e0 e8 04 4e 00 00 83 cb }
        $s3 = { 48 8d 54 24 50 b9 00 10 00 00 ff 15 d0 ed 01 00 e8 df e6 00 00 44 8b c8 4c 8d 05 19 17 02 00 ba 10 00 00 00 48 8d 4c 24 28 e8 52 c1 ff ff 33 db 48 8d 54 24 28 48 8d 4c 24 50 e8 59 cf 00 00 48 8b c8 48 8b f8 e8 46 0f 00 00 85 c0 0f 84 84 00 00 00 48 8b cf e8 da 71 00 00 ff c3 83 fb 05 7c cf 48 85 ed 74 69 45 33 c0 48 8d 15 84 16 02 00 33 c9 e8 a9 10 00 00 48 85 f6 74 3d 45 33 c0 48 8b d6 33 c9 48 8b f8 e8 94 10 00 00 48 8b d0 48 8b cf 48 8b d8 e8 ce bc 00 00 48 8b cf e8 92 71 00 00 48 8b cb e8 8a 71 00 00 48 8b ce e8 82 71 00 00 33 c0 e9 9f 00 00 00 33 d2 48 8b c8 48 8b d8 ff 15 01 ed 01 00 48 8b cb }
        $s4 = { 48 8b 07 45 33 c0 48 89 44 24 50 33 c9 48 8b 47 08 48 89 6c 24 48 48 89 44 24 40 c7 44 24 38 00 00 00 80 c7 44 24 30 00 00 00 80 c7 44 24 28 00 00 00 80 c7 44 24 20 00 00 00 80 ff 15 fa 35 02 00 48 89 6c 24 58 48 8d 15 fe 3b 02 00 48 89 87 30 20 00 00 41 b9 84 08 30 50 48 8b 07 45 33 c0 48 89 44 24 50 b9 00 02 00 00 48 8b 47 08 48 89 6c 24 48 48 89 44 24 40 c7 44 24 38 00 00 00 80 c7 44 24 30 00 00 00 80 c7 44 24 28 00 00 00 80 c7 44 24 20 00 00 00 80 ff 15 9d 35 02 00 48 89 6c 24 58 4c 8d 05 b1 3b 02 00 48 89 87 38 20 00 00 48 8d 15 b3 3b 02 00 48 8b 07 41 b9 01 00 00 50 48 89 44 24 50 33 c9 48 8b 47 08 48 c7 44 24 48 01 00 00 00 48 89 44 24 40 c7 44 24 38 00 00 00 80 c7 44 24 30 00 00 00 80 c7 44 24 28 00 00 00 80 c7 44 24 20 00 00 00 80 ff 15 3b 35 02 00 4c 8b 8f 50 20 00 00 45 33 c0 48 8b 4f 08 }
        $s5 = { 43 6f 75 6c 64 20 6e 6f 74 20 61 6c 6c 6f 63 61 74 65 20 62 75 66 66 65 72 20 66 6f 72 20 54 4f 43 21 0a 00 00 00 00 00 43 6f 75 6c 64 20 6e 6f 74 20 72 65 61 64 20 66 75 6c 6c 20 54 4f 43 21 0a 00 00 00 00 00 00 00 45 72 72 6f 72 20 6f 6e 20 66 69 6c 65 2e 0a 00 43 61 6e 6e 6f 74 20 61 6c 6c 6f 63 61 74 65 20 6d 65 6d 6f 72 79 20 66 6f 72 20 41 52 43 48 49 56 45 5f 53 54 41 54 55 53 }
        $s6 = "bcryptography\\hazmat\\bindings\\_openssl.pyd" ascii
        $s7 = "Cannot open self %s or archive %s\n" ascii
   condition:
        uint16(0) == 0x5A4D and filesize > 14500KB and all of ($s*) 
}
