rule RAN_Lockbit_Dec_2021_1 
{
   meta:
        description = "Detect Lockbit ransomware"
        author = "Arkbird_SOLG"
        reference = "Internal Research"
        date = "2021-12-23"
        hash1 = "786a4475e703e5c8d3d5cf05ca7071c579f856a1eb9afb3e4df359e7932b7170"
        hash2 = "e216372e4328f1cf5cf39a73540b508adc8d777fef90ca77af635c2331deb5cc"
        hash3 = "bdc2801e747ee4dd2b50b1ecd3fa3eb53b6c8101ec37eff8d18e485a7f4a7bd0"
        tlp = "Clear"
        adversary = "RAAS"
   strings:
        $s1 = { 8b 35 10 ?? 4f 00 8d 45 fc 50 6a 00 57 6a 29 ff d6 85 c0 75 34 8b 4d fc e8 [2] 06 00 8b d8 89 5d d8 85 db 0f 84 47 ff ff ff 8d 45 fc 50 53 57 6a 29 ff d6 85 c0 0f 84 35 ff ff ff 8d 45 e4 50 53 6a 00 ff 15 0c ?? 4f }
        $s2 = { 8b 35 28 ?? 4f 00 6a 00 68 80 00 00 00 6a 02 6a 00 6a 00 68 00 00 00 40 53 ff d6 89 45 d4 83 f8 ff 0f 84 ?? 03 00 00 6a 00 68 80 00 00 00 6a 02 6a 00 6a 00 68 00 00 00 40 57 ff d6 8b f0 89 75 dc 83 fe ff 0f 84 ?? 03 00 00 6a 00 8d 45 e8 50 8b 45 d4 68 9c 06 00 00 68 58 ?? 4e 00 50 ff 15 24 ?? 4f 00 85 c0 0f 84 }
        $s3 = { 66 0f 6e 01 8d 87 c0 00 00 00 66 0f 70 c8 00 66 0f 6e 41 04 66 0f 70 d0 00 66 0f 6e 41 08 66 0f 70 d8 00 66 0f 6e 41 0c 66 0f 70 e0 00 66 0f 6e 41 10 66 0f 70 e8 00 66 0f 6e 41 14 66 0f 70 f0 00 66 0f 6e 41 18 66 0f 70 f8 00 66 0f 6e 41 1c 8b 73 08 66 0f 70 c0 00 0f 29 85 60 fd ff ff 66 0f 6e 41 20 66 0f 70 c0 00 0f 29 85 50 fd ff ff 66 0f 6e 41 24 66 0f 70 c0 00 0f 29 85 40 fd ff ff 66 0f 6e 41 28 66 0f 70 c0 00 0f 29 85 e0 fd ff ff 66 0f 6e 41 2c 66 0f 70 c0 00 89 45 f8 8d 86 c0 00 00 00 0f 29 85 d0 fd ff ff 66 0f 6e 41 38 89 45 fc 8d 87 80 00 00 00 66 0f 70 c0 00 89 45 f0 8d 86 80 00 00 00 0f 29 85 c0 fd ff ff 66 0f 6e 41 3c 89 45 e4 8d 47 40 66 0f 70 c0 00 0f 29 85 b0 fd ff ff 0f 57 c0 89 45 f4 8d 46 40 0f 29 8d 90 fe ff ff 0f 29 95 80 fe ff ff 0f 29 9d 70 fe ff ff 0f 29 a5 60 fe ff ff 0f 29 ad 50 fe ff ff 0f 29 b5 40 fe ff ff 0f 29 bd 30 fe ff ff 66 0f 13 85 28 fd ff ff c7 85 68 ff ff ff 01 00 00 00 c7 85 6c ff ff ff 00 00 00 00 c7 85 60 ff ff ff 02 00 00 00 c7 85 64 ff ff ff 00 00 00 00 c7 85 58 ff ff ff 03 00 00 00 c7 85 5c ff ff ff 00 00 00 00 89 45 ec 0f 1f 00 8b 41 34 0f 28 c5 0f 29 45 90 33 d2 0b 51 30 0f 28 c6 0f 29 85 00 ff ff ff 0f 28 c7 0f 29 85 f0 fe ff ff 0f 28 85 50 fd ff ff 0f 29 85 70 ff ff ff 0f 28 85 40 fd ff ff 0f 28 bd c0 fd ff ff 0f 28 ad b0 fd ff ff 0f 29 45 a0 0f 28 85 e0 fd ff ff 0f 29 8d 20 ff ff ff 0f 29 85 d0 fe ff ff 0f 28 85 d0 fd ff ff 0f 29 95 10 ff ff ff 0f 28 95 60 fd ff ff 0f 29 9d e0 fe ff ff 0f 29 85 c0 fe ff ff 66 0f 6e c2 66 0f 6e c8 0f 29 55 80 66 0f 6e d0 66 0f 62 ca 66 0f 6e da 66 0f 62 d8 0f 28 05 [2] 40 00 66 0f 62 d9 0f 28 cb 0f 29 65 b0 66 0f d4 0d [2] 40 00 66 0f d4 c3 0f 28 f1 89 95 50 ff ff ff 66 0f 6a c8 66 0f 62 f0 89 95 48 ff ff ff 0f 28 e6 89 95 40 ff ff ff 89 95 38 ff ff ff 83 c2 04 66 0f 62 e1 66 0f 6a f1 89 85 54 ff ff ff 0f 28 ce 89 85 4c ff ff ff 89 85 44 ff ff ff 89 85 3c ff ff ff 83 d0 00 0f 29 8d a0 fe ff ff 0f 28 4d 90 89 41 34 b8 0a 00 00 00 0f 29 a5 f0 fd ff ff 89 51 30 eb 0a 66 0f 1f 44 00 00 0f 28 6d c0 0f 28 d1 66 0f fe 95 20 ff ff ff 66 0f ef e2 66 0f 38 00 25 [2] 40 00 0f 28 dc 66 0f fe 9d 70 ff ff ff 0f 28 c3 66 0f ef c1 0f 28 c8 66 0f 72 f0 0c 66 0f 72 d1 14 66 0f eb c8 0f 28 c1 66 0f fe c2 0f 28 95 00 ff ff ff 66 0f fe 95 10 ff ff ff 66 0f ef e0 66 0f 38 00 25 [2] 40 00 0f 29 85 70 ff ff ff 66 0f ef f2 66 0f 38 00 35 [2] 40 00 0f 28 c4 0f 29 a5 b0 fe ff ff 66 0f fe c3 0f 28 de 66 0f fe 5d a0 0f 29 85 30 fd ff ff 66 0f ef c1 0f 28 c8 66 0f 72 f0 07 66 0f 72 d1 19 66 0f eb c8 0f 28 c3 66 0f ef 85 00 ff ff ff 0f 29 8d 20 fe ff ff 0f 28 c8 66 0f 72 f0 0c 66 0f 72 d1 14 66 0f eb c8 0f 28 c1 66 0f fe c2 0f 28 95 f0 fe ff ff 66 0f fe 95 e0 fe ff ff 66 0f ef f0 66 0f 38 00 35 [2] 40 00 0f  }
        $s4 = { 00 00 eb fe c7 84 24 [2] 00 00 ?? 00 00 00 33 f6 c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? c6 84 24 [2] 00 00 ?? 8a 84 24 [2] 00 00 c6 84 24 [2] 00 00 00 66 66 0f 1f 84 00 00 00 00 00 8a 94 34 [2] 00 00 8b 84 24 [2] 00 00 0f be c8 0f be c2 33 c8 88 8c 34 [2] 00 00 46 83 fe 0b 72 dd a1 ?? 08 ?? 00 c6 84 24 [2] 00 00 00 }
        $s5 = { 52 00 65 00 67 00 69 00 73 00 74 00 72 00 79 00 5c 00 4d 00 61 00 63 00 68 00 69 00 6e 00 65 00 5c 00 53 00 6f 00 66 00 74 00 77 00 61 00 72 00 65 00 5c 00 43 00 6c 00 61 00 73 00 73 00 65 00 73 00 5c 00 4c 00 6f 00 63 00 6b 00 62 00 69 00 74 00 5c 00 73 00 68 00 65 00 6c 00 6c 00 5c 00 4f 00 70 00 65 00 6e 00 5c 00 43 00 6f 00 6d 00 6d 00 61 00 6e 00 64 00 00 00 00 00 00 00 22 00 43 00 3a 00 5c 00 57 00 69 00 6e 00 64 00 6f 00 77 00 73 00 5c 00 73 00 79 00 73 00 74 00 65 00 6d 00 33 00 32 00 5c 00 6d 00 73 00 68 00 74 00 61 00 2e 00 65 00 78 00 65 00 22 00 20 00 22 00 25 00 73 00 22 }
    condition:
        uint16(0) == 0x5A4D and filesize > 300KB and 4 of ($s*) 
}

