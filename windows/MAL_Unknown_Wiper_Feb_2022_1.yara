rule MAL_Unknown_Wiper_Feb_2022_1 : Wiper 
{
   meta:
        description = "Detect the wiper used against Iranian infrastructures"
        author = "Arkbird_SOLG"
        reference = "https://research.checkpoint.com/2022/evilplayout-attack-against-irans-state-broadcaster/"
        date = "2022-02-17"
        hash1 = "42ed646eed4f949c456c637a222e7d94dd8ac67ed5ebda5e63c7b7979076d9cf"
        hash2 = "1607f31ac66dfec739dc675ade921582acb8446c2ac7d6d1bc65a3e993fc5b54"
        tlp = "Clear"
        adversary = "-"
   strings:
        $s1 = { 28 2a 00 00 06 28 29 00 00 06 26 }
        $s2 = { 80 0f 00 00 04 28 1a 00 00 06 25 25 8e 69 17 59 9a 0a 72 ad 00 00 70 0b 7e 0f 00 00 04 72 ad 00 00 70 28 ?? 00 00 0a 2c 0b 7e 0f 00 00 04 28 ?? 00 00 0a 0b 0c 16 0d 38 8c 00 00 00 08 09 9a 13 04 07 72 ad 00 00 70 28 ?? 00 00 0a 2c 0f 11 04 6f ?? 00 00 0a 07 28 ?? 00 00 0a 2d 67 72 35 04 00 70 11 04 28 14 00 00 06 11 04 72 79 02 00 70 16 28 ?? 00 00 0a 11 04 06 28 ?? 00 00 0a 2c 0a 7e 08 00 00 04 16 fe 01 2b 01 16 02 28 19 00 00 06 de 03 26 de 00 00 11 04 72 79 02 00 70 16 28 ?? 00 00 0a 11 04 06 28 ?? 00 00 0a 2c 0a 7e 08 00 00 04 16 fe 01 2b 01 16 02 28 18 00 00 06 de 03 26 de 00 09 17 58 0d 09 08 8e 69 3f }
        $s3 = { 00 00 0a 6f ?? 00 00 0a 72 da 07 00 70 28 ?? 00 00 0a 0a 06 18 18 73 ?? 00 00 0a 73 ?? 00 00 0a 0b 28 2b 00 00 06 28 ?? 00 00 0a 73 ?? 00 00 0a 0c 08 16 73 ?? 00 00 0a 0d 20 00 40 00 00 8d ?? 00 00 01 13 04 2b 0b 07 11 04 16 11 05 6f ?? 00 00 0a 09 11 04 16 11 04 8e 69 6f ?? 00 00 0a 25 13 05 16 30 e2 09 6f ?? 00 00 0a 08 6f ?? 00 00 0a 07 6f ?? 00 00 0a 72 ee 07 00 70 06 28 ?? 00 00 0a 28 13 00 00 06 06 }
        $s4 = { 00 00 01 25 16 72 ad 00 00 70 a2 25 17 72 ad 00 00 70 a2 0a 72 62 07 00 70 28 ?? 00 00 0a 2c 0d 72 62 07 00 70 73 ?? 00 00 0a 0b 2b 0b 72 9a 07 00 70 73 ?? 00 00 0a 0b 07 16 6f ?? 00 00 0a 07 17 6f ?? 00 00 0a 07 17 6f ?? 00 00 0a 07 17 6f ?? 00 00 0a 07 28 ?? 00 00 0a 6f ?? 00 00 0a 07 28 ?? 00 00 0a 6f ?? 00 00 0a 07 72 aa 07 00 70 02 28 ?? 00 00 0a 6f ?? 00 00 0a 07 28 ?? 00 00 0a 25 6f ?? 00 00 0a 0c 25 6f ?? 00 00 0a 0d 06 16 09 6f ?? 00 00 0a 6f ?? 00 00 0a a2 06 17 08 6f ?? 00 00 0a 6f ?? 00 00 0a a2 08 6f ?? 00 00 0a 09 6f ?? 00 00 0a 6f ?? 00 00 0a de 37 13 04 06 17 11 04 6f ?? 00 00 0a a2 11 04 6f ?? 00 00 0a 2c 20 06 17 8f ?? 00 00 01 25 50 72 d6 07 00 70 11 04 6f ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 51 de }
        $s5 = { 00 00 0a 0a 72 55 05 00 70 7e 09 00 00 04 28 ?? 00 00 0a 28 29 00 00 06 0b 07 16 9a 28 ?? 00 00 0a 2c 02 14 2a 07 16 9a 6f ?? 00 00 0a 18 8d ?? 00 00 01 25 16 1f 0d 9d 25 17 1f 0a 9d 17 6f ?? 00 00 0a 0c 16 0d 2b 20 08 09 9a 16 13 04 6f ?? 00 00 0a 12 04 28 ?? 00 00 0a 2c 08 06 11 04 6f ?? 00 00 0a 09 17 58 0d 09 08 8e 69 32 da 06 6f ?? 00 00 0a }
    condition:
        uint16(0) == 0x5A4D and filesize > 100KB and all of ($s*) 
}
