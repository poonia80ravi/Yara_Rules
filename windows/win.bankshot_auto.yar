rule win_bankshot_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-10-07"
        version = "1"
        description = "Detects win.bankshot."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.bankshot"
        malpedia_rule_date = "20221007"
        malpedia_hash = "597f9539014e3d0f350c069cd804aa71679486ae"
        malpedia_version = "20221010"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8bf8 8d5101 8a01 41 84c0 75f9 57 }
            // n = 7, score = 300
            //   8bf8                 | add                 esp, 0x20
            //   8d5101               | imul                esi
            //   8a01                 | sar                 edx, 3
            //   41                   | mov                 ecx, edx
            //   84c0                 | shr                 ecx, 0x1f
            //   75f9                 | add                 edx, ecx
            //   57                   | imul                edx, edx, 0x1a

        $sequence_1 = { 8bec 81ec48040000 a1???????? 33c5 8945f8 53 }
            // n = 6, score = 300
            //   8bec                 | dec                 eax
            //   81ec48040000         | lea                 edx, [esp + 0x460]
            //   a1????????           |                     
            //   33c5                 | mov                 ecx, 0x104
            //   8945f8               | test                eax, eax
            //   53                   | je                  0x24d

        $sequence_2 = { 50 6a14 8d8dc0baffff e8???????? 83c40c 85c0 }
            // n = 6, score = 200
            //   50                   | jne                 0
            //   6a14                 | push                edi
            //   8d8dc0baffff         | test                al, al
            //   e8????????           |                     
            //   83c40c               | jne                 0xfffffffd
            //   85c0                 | lea                 eax, [ebp - 0xc010]

        $sequence_3 = { 59 c74048b8e40110 8b4508 6689486c 8b4508 66898872010000 }
            // n = 6, score = 200
            //   59                   | inc                 edx
            //   c74048b8e40110       | mov                 dword ptr [ebp - 0x20], eax
            //   8b4508               | lea                 eax, [eax + 0x1001e1d0]
            //   6689486c             | mov                 dword ptr [ebp - 0x1c], eax
            //   8b4508               | cmp                 byte ptr [eax], 0
            //   66898872010000       | mov                 ecx, eax

        $sequence_4 = { e8???????? 83c404 89861c020000 8b45e0 8d4e0c 6a06 8d90c4e10110 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   83c404               | mov                 word ptr [ecx], ax
            //   89861c020000         | jne                 0x17
            //   8b45e0               | mov                 eax, dword ptr [ebp - 4]
            //   8d4e0c               | cmp                 dword ptr [eax + 0x48], 0x1001e4b8
            //   6a06                 | je                  0x15
            //   8d90c4e10110         | push                dword ptr [eax + 0x48]

        $sequence_5 = { c700???????? 8b4508 898850030000 8b4508 59 c74048b8e40110 8b4508 }
            // n = 7, score = 200
            //   c700????????         |                     
            //   8b4508               | lea                 edx, [eax + 0x1001e1c4]
            //   898850030000         | mov                 al, byte ptr [edi + 0x1001e1bc]
            //   8b4508               | or                  byte ptr [esi + edx + 0x19], al
            //   59                   | inc                 edx
            //   c74048b8e40110       | movzx               eax, byte ptr [ecx + 1]
            //   8b4508               | cmp                 edx, eax

        $sequence_6 = { 755c 8d45ec 50 ff15???????? 8d45e4 50 }
            // n = 6, score = 200
            //   755c                 | sub                 esp, 0x448
            //   8d45ec               | xor                 eax, ebp
            //   50                   | mov                 dword ptr [ebp - 8], eax
            //   ff15????????         |                     
            //   8d45e4               | push                ebx
            //   50                   | mov                 edi, eax

        $sequence_7 = { 4b 7515 8b45fc 817848b8e40110 7409 }
            // n = 5, score = 200
            //   4b                   | je                  0x3c
            //   7515                 | mov                 al, byte ptr [ecx + 1]
            //   8b45fc               | lock xadd           dword ptr [eax], ebx
            //   817848b8e40110       | dec                 ebx
            //   7409                 | jne                 0x18

        $sequence_8 = { 84c0 75f9 8b1d???????? 8d85f03fffff 6a00 }
            // n = 5, score = 200
            //   84c0                 | push                ebx
            //   75f9                 | mov                 ebp, esp
            //   8b1d????????         |                     
            //   8d85f03fffff         | sub                 esp, 0x448
            //   6a00                 | xor                 eax, ebp

        $sequence_9 = { 2bd0 0f10040f 0f28ca 660fefc8 }
            // n = 4, score = 200
            //   2bd0                 | mov                 dword ptr [ebp - 8], eax
            //   0f10040f             | push                ebx
            //   0f28ca               | push                ebp
            //   660fefc8             | mov                 ebp, esp

        $sequence_10 = { e8???????? 83c40c e8???????? 99 b907000000 f7f9 }
            // n = 6, score = 200
            //   e8????????           |                     
            //   83c40c               | push                0
            //   e8????????           |                     
            //   99                   | push                dword ptr [ebp - 0x43c]
            //   b907000000           | mov                 ecx, edi
            //   f7f9                 | push                0x408

        $sequence_11 = { 8d80d0e10110 8945e4 803800 8bc8 7435 8a4101 }
            // n = 6, score = 200
            //   8d80d0e10110         | push                6
            //   8945e4               | lea                 edx, [eax + 0x1001e1c4]
            //   803800               | mov                 eax, dword ptr [ebp + 8]
            //   8bc8                 | mov                 eax, dword ptr [ebp + 8]
            //   7435                 | mov                 dword ptr [eax + 0x350], ecx
            //   8a4101               | mov                 eax, dword ptr [ebp + 8]

        $sequence_12 = { 40 3d2c010000 7cf0 8b15???????? 8d8528beffff }
            // n = 5, score = 200
            //   40                   | lea                 edx, [ecx + 1]
            //   3d2c010000           | mov                 al, byte ptr [ecx]
            //   7cf0                 | inc                 ecx
            //   8b15????????         |                     
            //   8d8528beffff         | test                al, al

        $sequence_13 = { 7313 8a87bce10110 08441619 42 0fb64101 }
            // n = 5, score = 200
            //   7313                 | push                6
            //   8a87bce10110         | lea                 edx, [eax + 0x1001e1c4]
            //   08441619             | pop                 edi
            //   42                   | mov                 ax, word ptr [edx]
            //   0fb64101             | lea                 edx, [edx + 2]

        $sequence_14 = { e8???????? 83c40c 6b45e430 8945e0 8d80d0e10110 8945e4 }
            // n = 6, score = 200
            //   e8????????           |                     
            //   83c40c               | mov                 eax, dword ptr [ebp + 8]
            //   6b45e430             | pop                 ecx
            //   8945e0               | mov                 dword ptr [eax + 0x48], 0x1001e4b8
            //   8d80d0e10110         | mov                 eax, dword ptr [ebp + 8]
            //   8945e4               | jne                 0x17

        $sequence_15 = { 817848b8e40110 7409 ff7048 e8???????? }
            // n = 4, score = 200
            //   817848b8e40110       | mov                 ecx, eax
            //   7409                 | lea                 edx, [eax + 0x1001e1c4]
            //   ff7048               | pop                 edi
            //   e8????????           |                     

        $sequence_16 = { 56 50 e8???????? 83c40c 8d95e4bfffff }
            // n = 5, score = 200
            //   56                   | push                0
            //   50                   | sub                 edx, eax
            //   e8????????           |                     
            //   83c40c               | movups              xmm0, xmmword ptr [edi + ecx]
            //   8d95e4bfffff         | movaps              xmm1, xmm2

        $sequence_17 = { 4883ec20 488d1d5b220000 488d3d54220000 eb0e 488b03 }
            // n = 5, score = 100
            //   4883ec20             | dec                 eax
            //   488d1d5b220000       | lea                 ecx, [0x4ff]
            //   488d3d54220000       | dec                 eax
            //   eb0e                 | mov                 dword ptr [ebx + 4], 0
            //   488b03               | xor                 eax, eax

        $sequence_18 = { 8b55f8 81c218020000 8955ec 8b45ec 8945d0 }
            // n = 5, score = 100
            //   8b55f8               | mov                 ecx, 7
            //   81c218020000         | add                 esp, 0xc
            //   8955ec               | cdq                 
            //   8b45ec               | mov                 ecx, 7
            //   8945d0               | idiv                ecx

        $sequence_19 = { 52 ff15???????? 85c0 7515 8b4508 }
            // n = 5, score = 100
            //   52                   | jmp                 0xf
            //   ff15????????         |                     
            //   85c0                 | push                0x12c
            //   7515                 | jmp                 0xffffffa3
            //   8b4508               | cmp                 dword ptr [ebp - 0xcac], 3

        $sequence_20 = { 83f801 0f8553020000 488d942460040000 b904010000 ff15???????? }
            // n = 5, score = 100
            //   83f801               | jmp                 0x13
            //   0f8553020000         | mov                 dword ptr [ebx], 1
            //   488d942460040000     | dec                 eax
            //   b904010000           | mov                 dword ptr [ebx + 0xc], edi
            //   ff15????????         |                     

        $sequence_21 = { 8d542478 f2ae f7d1 2bf9 50 }
            // n = 5, score = 100
            //   8d542478             | mov                 byte ptr [esp + 0x73], 0xb2
            //   f2ae                 | mov                 byte ptr [esp + 0x74], 0x94
            //   f7d1                 | mov                 dword ptr [eax], esi
            //   2bf9                 | jl                  0xffffffe4
            //   50                   | sub                 ecx, ebp

        $sequence_22 = { e8???????? 59 83cfff 897de4 8365fc00 8b049dc87f0110 8b4de0 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   59                   | xor                 eax, ebp
            //   83cfff               | mov                 dword ptr [ebp - 8], eax
            //   897de4               | push                ebx
            //   8365fc00             | mov                 edi, eax
            //   8b049dc87f0110       | lea                 edx, [ecx + 1]
            //   8b4de0               | mov                 al, byte ptr [ecx]

        $sequence_23 = { 50 51 52 e8???????? 8b8c2420010000 }
            // n = 5, score = 100
            //   50                   | mov                 edi, esi
            //   51                   | inc                 edx
            //   52                   | mov                 byte ptr [ecx + 0x420360], al
            //   e8????????           |                     
            //   8b8c2420010000       | or                  ecx, 0xffffffff

        $sequence_24 = { 8930 3d???????? 7ce2 8915???????? }
            // n = 4, score = 100
            //   8930                 | mov                 ecx, 7
            //   3d????????           |                     
            //   7ce2                 | idiv                ecx
            //   8915????????         |                     

        $sequence_25 = { 6a5c 50 8d4c2418 6a10 51 c6442473b2 c644247494 }
            // n = 7, score = 100
            //   6a5c                 | lea                 edx, [eax + 0x1001e1c4]
            //   50                   | test                ebx, ebx
            //   8d4c2418             | jne                 9
            //   6a10                 | mov                 dword ptr [esi + 0x34], 0x10017b0c
            //   51                   | push                edi
            //   c6442473b2           | add                 esp, 0xc
            //   c644247494           | cdq                 

        $sequence_26 = { 44891d???????? ff15???????? 85c0 7525 ff15???????? 33c0 }
            // n = 6, score = 100
            //   44891d????????       |                     
            //   ff15????????         |                     
            //   85c0                 | add                 ebx, esi
            //   7525                 | xor                 eax, eax
            //   ff15????????         |                     
            //   33c0                 | dec                 ebp

        $sequence_27 = { 75e2 8b9558f8ffff 2b95fcf7ffff 8995f8f7ffff 8b85f8f7ffff 8b8d70f8ffff }
            // n = 6, score = 100
            //   75e2                 | and                 edi, 0xf
            //   8b9558f8ffff         | add                 esp, 0xc
            //   2b95fcf7ffff         | cdq                 
            //   8995f8f7ffff         | mov                 ecx, 7
            //   8b85f8f7ffff         | idiv                ecx
            //   8b8d70f8ffff         | add                 esp, 0xc

        $sequence_28 = { e8???????? 488d0dff040000 e8???????? 488d0de7030000 e8???????? 33c0 4883c420 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   488d0dff040000       | dec                 eax
            //   e8????????           |                     
            //   488d0de7030000       | lea                 edi, [0x2254]
            //   e8????????           |                     
            //   33c0                 | jmp                 0x1e
            //   4883c420             | dec                 eax

        $sequence_29 = { 50 ffd3 8985c8feffff 85c0 7508 8b36 85f6 }
            // n = 7, score = 100
            //   50                   | inc                 ecx
            //   ffd3                 | test                al, al
            //   8985c8feffff         | jne                 0
            //   85c0                 | push                edi
            //   7508                 | sub                 esp, 0x448
            //   8b36                 | xor                 eax, ebp
            //   85f6                 | mov                 dword ptr [ebp - 8], eax

        $sequence_30 = { 8d4301 eb23 48832300 e8???????? 488d0dff040000 }
            // n = 5, score = 100
            //   8d4301               | dec                 eax
            //   eb23                 | mov                 dword ptr [esp + 0x28], eax
            //   48832300             | cmp                 esi, ebx
            //   e8????????           |                     
            //   488d0dff040000       | jb                  0xffffff53

        $sequence_31 = { 89853cf3ffff 8b8d48f3ffff 83c101 898d48f3ffff 80bdc6f3ffff00 75bd }
            // n = 6, score = 100
            //   89853cf3ffff         | jne                 0xffffffe4
            //   8b8d48f3ffff         | mov                 edx, dword ptr [ebp - 0x7a8]
            //   83c101               | sub                 edx, dword ptr [ebp - 0x804]
            //   898d48f3ffff         | mov                 dword ptr [ebp - 0x808], edx
            //   80bdc6f3ffff00       | mov                 eax, dword ptr [ebp - 0x808]
            //   75bd                 | mov                 ecx, dword ptr [ebp - 0x790]

        $sequence_32 = { e8???????? 458b5c240c 4c8d442420 33d2 4d03de 33c0 4d2bc3 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   458b5c240c           | inc                 ebp
            //   4c8d442420           | mov                 ebx, dword ptr [esp + 0xc]
            //   33d2                 | dec                 esp
            //   4d03de               | lea                 eax, [esp + 0x20]
            //   33c0                 | xor                 edx, edx
            //   4d2bc3               | dec                 ebp

        $sequence_33 = { 4883c004 ffc6 4889442428 3bf3 0f8244ffffff 33c0 85db }
            // n = 7, score = 100
            //   4883c004             | sub                 eax, ebx
            //   ffc6                 | test                eax, eax
            //   4889442428           | jne                 0x27
            //   3bf3                 | xor                 eax, eax
            //   0f8244ffffff         | dec                 eax
            //   33c0                 | add                 eax, 4
            //   85db                 | inc                 esi

        $sequence_34 = { 6a00 6a00 ffb5c4fbffff 8bcf 6808040000 e8???????? 85c0 }
            // n = 7, score = 100
            //   6a00                 | push                ebx
            //   6a00                 | mulpd               xmm6, xmm5
            //   ffb5c4fbffff         | movapd              xmm5, xmmword ptr [edx + 0x10013fd0]
            //   8bcf                 | andpd               xmm4, xmm5
            //   6808040000           | addpd               xmm7, xmm6
            //   e8????????           |                     
            //   85c0                 | addpd               xmm7, xmm4

        $sequence_35 = { 660f282d???????? 660f59f5 660f28aad03f0110 660f54e5 660f58fe 660f58fc }
            // n = 6, score = 100
            //   660f282d????????     |                     
            //   660f59f5             | mov                 dword ptr [ebp - 8], eax
            //   660f28aad03f0110     | push                ebx
            //   660f54e5             | push                ebp
            //   660f58fe             | mov                 ebp, esp
            //   660f58fc             | sub                 esp, 0x448

        $sequence_36 = { 7428 8bcb e8???????? 85c0 741d 56 57 }
            // n = 7, score = 100
            //   7428                 | mov                 ecx, 7
            //   8bcb                 | idiv                ecx
            //   e8????????           |                     
            //   85c0                 | add                 esp, 0xc
            //   741d                 | cdq                 
            //   56                   | mov                 ecx, 7
            //   57                   | push                0x5c

        $sequence_37 = { eb0d 682c010000 ff15???????? eba1 83bd54f3ffff03 }
            // n = 5, score = 100
            //   eb0d                 | cdq                 
            //   682c010000           | mov                 ecx, 7
            //   ff15????????         |                     
            //   eba1                 | add                 esp, 0xc
            //   83bd54f3ffff03       | cdq                 

        $sequence_38 = { ff15???????? 8bf0 85f6 0f84b0010000 68???????? 56 }
            // n = 6, score = 100
            //   ff15????????         |                     
            //   8bf0                 | pop                 ecx
            //   85f6                 | or                  edi, 0xffffffff
            //   0f84b0010000         | mov                 dword ptr [ebp - 0x1c], edi
            //   68????????           |                     
            //   56                   | and                 dword ptr [ebp - 4], 0

        $sequence_39 = { c644242af7 c644242bf1 c644242de3 c644242ede }
            // n = 4, score = 100
            //   c644242af7           | push                eax
            //   c644242bf1           | lea                 ecx, [esp + 0x18]
            //   c644242de3           | push                0x10
            //   c644242ede           | push                ecx

        $sequence_40 = { 2bcd 8bfe 42 888160034200 83c9ff }
            // n = 5, score = 100
            //   2bcd                 | add                 esp, 0xc
            //   8bfe                 | cdq                 
            //   42                   | mov                 ecx, 7
            //   888160034200         | add                 esp, 0xc
            //   83c9ff               | cdq                 

        $sequence_41 = { 33c0 8d9f18040000 66890473 398714040000 0f84c6000000 b9???????? 8d8710020000 }
            // n = 7, score = 100
            //   33c0                 | mov                 eax, dword ptr [ebx*4 + 0x10017fc8]
            //   8d9f18040000         | mov                 ecx, dword ptr [ebp - 0x20]
            //   66890473             | push                eax
            //   398714040000         | call                ebx
            //   0f84c6000000         | mov                 dword ptr [ebp - 0x138], eax
            //   b9????????           |                     
            //   8d8710020000         | test                eax, eax

        $sequence_42 = { 75be ddd8 db2d???????? b802000000 833d????????00 0f85b01c0000 }
            // n = 6, score = 100
            //   75be                 | push                edi
            //   ddd8                 | imul                edi, eax, 0x30
            //   db2d????????         |                     
            //   b802000000           | mov                 eax, dword ptr [ecx*4 + 0x7188c8]
            //   833d????????00       |                     
            //   0f85b01c0000         | mov                 dword ptr [ebp - 0x10], ecx

        $sequence_43 = { ff15???????? 48c7430400000000 33c0 eb0f c70301000000 48897b0c b801000000 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   48c7430400000000     | xor                 eax, eax
            //   33c0                 | test                ebx, ebx
            //   eb0f                 | lea                 eax, [ebx + 1]
            //   c70301000000         | jmp                 0x25
            //   48897b0c             | dec                 eax
            //   b801000000           | and                 dword ptr [ebx], 0

        $sequence_44 = { 57 6bf830 8b048dc8887100 894df0 }
            // n = 4, score = 100
            //   57                   | lea                 eax, [edi + 0x210]
            //   6bf830               | mov                 dword ptr [ebp - 0x30], eax
            //   8b048dc8887100       | mov                 edi, dword ptr [edi]
            //   894df0               | add                 edi, eax

    condition:
        7 of them and filesize < 860160
}