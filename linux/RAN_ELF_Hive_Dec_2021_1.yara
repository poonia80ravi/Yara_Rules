rule RAN_ELF_Hive_Dec_2021_1 {
   meta:
        description = "Detect ELF version of Hive ransomware (x64 version)"
        author = "Arkbird_SOLG"
        reference = "https://twitter.com/ESETresearch/status/1454100591261667329"
        date = "2021-10-29"
        hash1 = "6a0449a0b92dc1b17da219492487de824e86a25284f21e6e3af056fe3f4c4ec0"
        hash2 = "713b699c04f21000fca981e698e1046d4595f423bd5741d712fd7e0bc358c771"
        hash3 = "12389b8af28307fd09fe080fd89802b4e616ed4c961f464f95fdb4b3f0aaf185"
        tlp = "Clear"
        adversary = "Hive"
   strings:
        $s1 = { 48 83 ec 28 48 89 6c 24 20 48 8d 6c 24 20 4c 89 74 24 18 49 8b 06 48 89 44 24 10 0f 1f 44 00 00 48 85 c0 75 39 49 8b 4e 08 48 89 4c 24 08 48 85 c9 75 09 48 c7 44 24 08 00 20 00 00 48 8d 4c 24 08 48 8b 54 24 18 48 89 4a 08 48 8b 5c 24 08 48 29 d9 48 81 c1 00 04 00 00 48 89 0a eb 05 48 8b 54 24 18 48 8b 02 48 05 a0 03 00 00 48 89 42 10 48 89 42 18 e8 27 00 00 00 48 8b 44 24 10 48 85 c0 0f 94 c0 e8 d7 01 00 00 48 8b 6c 24 20 }
        $s2 = { 83 ec 08 48 89 2c 24 48 8d 2c 24 e8 e9 f8 ff ff 89 05 [3] 00 0f 1f 00 e8 9b fe ff ff 48 89 05 [3] 00 80 3d [3] 00 00 74 2d 90 8b 05 [3] 00 0f ba f0 1f 89 05 [3] 00 90 8b 05 [3] 00 89 c1 83 e0 fe 89 05 [3] 00 90 83 e1 fc 89 0d [3] 00 48 8b 2c 24 48 83 c4 08 c3 e8 } 
        $s3 = { 48 89 44 24 38 48 8b 51 08 48 89 54 24 40 0f 10 41 10 0f 11 44 24 48 0f 10 41 20 0f 11 44 24 58 0f 10 41 30 0f 11 44 24 68 49 8b 4e 30 48 c7 41 10 00 00 00 00 49 8b 4e 30 48 c7 41 30 00 00 00 00 49 8b 4e 30 48 c7 41 08 00 00 00 00 49 8b 4e 30 48 c7 41 18 00 00 00 00 48 8b 48 10 0f 1f 44 00 00 48 81 f9 de fa ff ff 75 64 48 89 4c 24 28 49 8b 56 30 83 ba 08 01 00 00 00 75 20 83 ba f0 00 00 00 00 75 17 48 83 ba 00 01 00 00 00 75 0d 48 8b 92 d0 00 00 00 83 7a 04 01 74 32 48 8b 08 48 81 c1 a0 03 00 00 48 89 48 10 48 8d 48 38 48 89 0c 24 e8 8a 01 01 00 45 0f 57 ff 64 4c 8b 34 25 f8 ff ff ff 48 8b 44 24 38 48 8b 4c 24 }
        $s4 = { 48 8b 9f 48 01 00 00 48 8d 05 [3] 00 31 c9 90 e8 [2] fc ff 48 8b 0d [3] 00 48 8d 71 01 48 8b 1d [3] 00 48 8b 3d [3] 00 66 90 48 39 f7 73 47 48 89 84 24 88 00 00 00 48 8d 05 [3] 00 e8 e7 36 ff ff 48 89 0d [3] 00 83 3d 49 [2] 00 00 75 09 48 89 05 [3] 00 eb 0c 48 8d 3d [3] 00 e8 62 7a 00 00 48 89 d9 48 89 c3 48 8b 84 24 88 00 00 00 48 8d 51 01 48 89 15 [3] 00 48 8d 3c cb 83 3d 0e [2] 00 00 75 15 48 89 04 cb 48 8b 94 24 c0 00 00 00 48 89 82 00 02 00 00 eb 19 e8 22 7a 00 00 48 8b 94 24 c0 00 00 00 48 8d ba 00 02 00 00 e8 0e 7a 00 00 48 8b b2 40 01 00 00 48 89 b4 24 b8 00 00 00 48 8b ba 48 01 00 00 48 89 7c 24 68 31 c0 e9 d4 01 00 00 48 8b 84 24 80 00 00 00 48 8b 4c 24 70 48 8b 94 24 c8 00 00 00 48 8b 74 24 78 48 8b bc 24 c0 00 00 00 e9 9d fe ff ff 48 8b ac 24 b0 02 00 00 48 81 c4 b8 02 00 00 c3 4c 8b 5c 24 60 49 8d 5b 01 48 8b 84 24 80 00 00 00 48 8b 4c 24 70 48 8b 94 24 c8 00 00 00 48 8b 74 24 78 48 8b bc 24 c0 00 00 00 4c 8b 84 24 a0 00 00 00 4c 8b 8c 24 b8 00 00 00 }
   condition:
        uint32(0) == 0x464C457F and filesize > 600KB and all of ($s*) 
}

